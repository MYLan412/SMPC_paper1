clear all;
close all;
%% [e(k) Δx(k) X_R(k)]  65*65  这是例1中预见长度为 8 的程序
I_N = eye(5);
I_m = eye(1);
I_mN = eye(5);
I_s = eye(65);
A_R = [ zeros(40,5) eye(40);
        zeros(5,45)];
A_R_3 = [ zeros(40,5) eye(40);
        zeros(5,45)];

A1 =  [  0.0571    0.0200    0.7000
        -0.0571    0.0400    0.0100
        0.0013    -0.0083    0.1000 ] ;
A2 = [ 0.0571     0.0200    0.7000
       -0.0571    0.0400    0.0100
       0.0026    -0.0165    0.1000] ;
B = [  2;
       0;
       0 ];
  
A1_d = [    0.0063    0.0040    0.0040
           -0.0063    0.0500    0.0800
            0.0023    0.0075   -0.2000 ];
     
A2_d = [    0.0063    0.0020    0.0060
           -0.0063    0.0200    0.0700
            0.0047    0.0052   -0.2000 ];
     
C = [-0.02  -0.01   -0.01 ];

L = [ 4  -1  -1  -1  -1 ;
      0  3  -1  -1  -1;
     -1  0  3   -1   -1;
      -1  -1  -1   4  -1;
     -1  -1  -1  -1   4];
M = [ 1 0 0 0 0;
      0 1 0 0 0;
      0 0 1 0 0;
      0 0 0 1 0;
      0 0 0 0 1 ];
H = L + M;

A_R0_1 = [    I_N  kron(-H,C*A1)  zeros(5)  kron(M,I_m)  zeros(5,35);
            zeros(15,5)  kron(I_N,A1)  zeros(15,45);
            zeros(45,20)  A_R    ];
A_R0_1_d = [ zeros(5)  kron(-H,C*A1_d)  zeros(5,45);
             zeros(15,5)  kron(I_N,A1_d)  zeros(15,45);
             zeros(45,65)];

A_R0_2 = [    I_N  kron(-H,C*A2)  zeros(5)  kron(M,I_m)  zeros(5,35);
            zeros(15,5)  kron(I_N,A2)  zeros(15,45);
            zeros(45,20)  A_R    ];
A_R0_2_d = [ zeros(5)  kron(-H,C*A2_d)  zeros(5,45);
             zeros(15,5)  kron(I_N,A2_d)  zeros(15,45);
             zeros(45,65)];

B_R0 = [    kron(-H,C*B);
            kron(I_N,B);
            zeros(45,5) ];
G_hat = eye(65) - B_R0*inv(B_R0'*B_R0)*B_R0';

F = [ kron(-H,C);
      eye(15);
      zeros(45,15)];
D = [ eye(5)  zeros(5,60) ];

% %%
% setlmis([]);
% 
% %%
% % 
% gama = lmivar(2,[1,1]);
% % 表示矩阵
% P0 = lmivar(1,[65,1]); % P
% Q0 = lmivar(1,[65,1]); % Q
% R0 = lmivar(1,[65,1]);  % R
% Y01 = lmivar(2,[5,65]); % Y1
% Y02 = lmivar(2,[5,65]); % Y2
% 
% 
% %% 第一个大矩阵 < 0
% % (1,1)
% lmiterm([1 1 1 Q0],1,1);
% % lmiterm([1 1 1 R0'],-(A_R0_1-eye(35)),1);
% lmiterm([1 1 1 Y01],-B_R0,1,'s');
% lmiterm([1 1 1 R0],-1,(A_R0_1-I_s)','s');
% % lmiterm([1 1 1 Y01'],-1,B_R0');
% 
% % (1,2)
% lmiterm([1 1 2 P0],1,1);
% lmiterm([1 1 2 R0'],1,1);
% lmiterm([1 1 2 -R0],1,(A_R0_1-I_s)');
% lmiterm([1 1 2 -Y01'],1,B_R0');
% 
% % (1,3)
% lmiterm([1 1 3 R0'],-G_hat*A_R0_1_d,1);
% 
% % (1,4)
% lmiterm([1 1 4 0],-G_hat*F);
% 
% % (1,5)
% lmiterm([1 1 5 R0],1,D');
% 
% % (2,2)
% lmiterm([1 2 2 P0],1,1);
% lmiterm([1 2 2 R0],1,1,'s');
% % lmiterm([1 2 2 R0'],1,1);
% 
% % (2,3)
% lmiterm([1 2 3 R0'],-G_hat*A_R0_1_d,1);
% 
% % (2,4)
% lmiterm([1 2 4 0],-G_hat*F);
% 
% % (2,5)
% lmiterm([1 2 5 0],0);
% 
% % (3,3)
% lmiterm([1 3 3 Q0],-1,1);
% 
% % (3,4)
% lmiterm([1 3 4 0],0);
% 
% % (3,5)
% lmiterm([1 3 5 0],0);
% 
% % (4,4)
% lmiterm([1 4 4 gama^2],-1,eye(15));
% 
% % (4,5)
% lmiterm([1 4 5 0],0);
% 
% % (5,5)
% lmiterm([1 5 5 0],-eye(5));
% 
% %% 第二个大矩阵 < 0
% % (1,1)
% lmiterm([2 1 1 Q0],1,1);
% % lmiterm([1 1 1 R0'],-(A_R0_1-eye(35)),1);
% lmiterm([2 1 1 Y02],-B_R0,1,'s');
% lmiterm([2 1 1 R0],-1,(A_R0_2-I_s)','s');
% % lmiterm([1 1 1 Y01'],-1,B_R0');
% 
% % (1,2)
% lmiterm([2 1 2 P0],1,1);
% lmiterm([2 1 2 R0'],1,1);
% lmiterm([2 1 2 -R0],1,(A_R0_2-I_s)');
% lmiterm([2 1 2 -Y02'],1,B_R0');
% 
% % (1,3)
% lmiterm([2 1 3 R0'],-G_hat*A_R0_2_d,1);
% 
% % (1,4)
% lmiterm([2 1 4 0],-G_hat*F);
% 
% % (1,5)
% lmiterm([2 1 5 R0],1,D');
% 
% % (2,2)
% lmiterm([2 2 2 P0],1,1);
% lmiterm([2 2 2 R0],1,1,'s');
% % lmiterm([1 2 2 R0'],1,1);
% 
% % (2,3)
% lmiterm([2 2 3 R0'],-G_hat*A_R0_2_d,1);
% 
% % (2,4)
% lmiterm([2 2 4 0],-G_hat*F);
% 
% % (2,5)
% lmiterm([2 2 5 0],0);
% 
% % (3,3)
% lmiterm([2 3 3 Q0],-1,1);
% 
% % (3,4)
% lmiterm([2 3 4 0],0);
% 
% % (3,5)
% lmiterm([2 3 5 0],0);
% 
% % (4,4)
% lmiterm([2 4 4 gama^2],-1,eye(15));
% 
% % (4,5)
% lmiterm([2 4 5 0],0);
% 
% % (5,5)
% lmiterm([2 5 5 0],-eye(5));
% 
% %% 第三个大矩阵 < 0
% % (1,1)
% lmiterm([3 1 1 Q0],2,1);
% lmiterm([3 1 1 R0'],-(3/2)*(A_R0_1-I_s),1,'s');
% lmiterm([3 1 1 Y02],-(1/2)*B_R0,1,'s');
% lmiterm([3 1 1 R0'],-(1/2)*(A_R0_2-I_s),1,'s');
% lmiterm([3 1 1 Y01],-(3/2)*B_R0,1,'s');
% 
% % (1,2)
% lmiterm([3 1 2 P0],2,1);
% lmiterm([3 1 2 R0'],2,1);
% lmiterm([3 1 2 -R0],3/2,(A_R0_1-I_s)');
% lmiterm([3 1 2 -Y02'],1/2,B_R0');
% lmiterm([3 1 2 -R0],1/2,(A_R0_2-I_s)');
% lmiterm([3 1 2 -Y01'],3/2,B_R0');
% 
% % (1,3)
% lmiterm([3 1 3 R0'],-(3/2)*G_hat*A_R0_1_d,1);
% lmiterm([3 1 3 R0'],-(1/2)*G_hat*A_R0_2_d,1);
% 
% % (1,4)
% lmiterm([3 1 4 0],-2*G_hat*F);
% 
% % (1,5)
% lmiterm([3 1 5 R0],2,D');
% 
% % (2,2)
% lmiterm([3 2 2 P0],2,1);
% lmiterm([3 2 2 R0],2,1,'s');
% 
% % (2,3)
% lmiterm([3 2 3 R0'],-(3/2)*G_hat*A_R0_1_d,1);
% lmiterm([3 2 3 R0'],-(1/2)*G_hat*A_R0_2_d,1);
% 
% % (2,4)
% lmiterm([3 2 4 0],-2*G_hat*F);
% 
% % (2,5)
% lmiterm([3 2 5 0],0);
% 
% % (3,3)
% lmiterm([3 3 3 Q0],-2,1);
% 
% % (3,4)
% lmiterm([3 3 4 0],0);
% 
% % (3,5)
% lmiterm([3 3 5 0],0);
% 
% % (4,4)
% lmiterm([3 4 4 gama^2],-2,eye(15));
% 
% % (4,5)
% lmiterm([3 4 5 0],0);
% 
% % (5,5)
% lmiterm([3 5 5 0],-2*eye(5));
% 
% %% 第四个大矩阵 < 0
% % (1,1)
% lmiterm([4 1 1 Q0],2,1);
% lmiterm([4 1 1 R0'],-(1/2)*(A_R0_1-I_s),1,'s');
% lmiterm([4 1 1 Y02],-(3/2)*B_R0,1,'s');
% lmiterm([4 1 1 R0'],-(3/2)*(A_R0_2-I_s),1,'s');
% lmiterm([4 1 1 Y01],-(1/2)*B_R0,1,'s');
% 
% % (1,2)
% lmiterm([4 1 2 P0],2,1);
% lmiterm([4 1 2 R0'],2,1);
% lmiterm([4 1 2 -R0],1/2,(A_R0_1-I_s)');
% lmiterm([4 1 2 -Y02'],3/2,B_R0');
% lmiterm([4 1 2 -R0],3/2,(A_R0_2-I_s)');
% lmiterm([4 1 2 -Y01'],1/2,B_R0');
% 
% % (1,3)
% lmiterm([4 1 3 R0'],-(1/2)*G_hat*A_R0_1_d,1);
% lmiterm([4 1 3 R0'],-(3/2)*G_hat*A_R0_2_d,1);
% 
% % (1,4)
% lmiterm([4 1 4 0],-2*G_hat*F);
% 
% % (1,5)
% lmiterm([4 1 5 R0],2,D');
% 
% % (2,2)
% lmiterm([4 2 2 P0],2,1);
% lmiterm([4 2 2 R0],2,1,'s');
% 
% % (2,3)
% lmiterm([4 2 3 R0'],-(1/2)*G_hat*A_R0_1_d,1);
% lmiterm([4 2 3 R0'],-(3/2)*G_hat*A_R0_2_d,1);
% 
% % (2,4)
% lmiterm([4 2 4 0],-2*G_hat*F);
% 
% % (2,5)
% lmiterm([4 2 5 0],0);
% 
% % (3,3)
% lmiterm([4 3 3 Q0],-2,1);
% 
% % (3,4)
% lmiterm([4 3 4 0],0);
% 
% % (3,5)
% lmiterm([4 3 5 0],0);
% 
% % (4,4)
% lmiterm([4 4 4 gama^2],-2,eye(15));
% 
% % (4,5)
% lmiterm([4 4 5 0],0);
% 
% % (5,5)
% lmiterm([4 5 5 0],-2*eye(5));
% 
% 
% %% 约束条件
% lmiterm([-5 1 1 P0],1,1);
% lmiterm([5 1 1 0],0);
% 
% lmiterm([-6 1 1 gama],1,1);
% lmiterm([6 1 1 0],0);
% 
% lmiterm([-7 1 1 Q0],1,1);
% lmiterm([7 1 1 0],0);
% 
% %%
% lmisys=getlmis;
% options=[0,0,0,0,0];
% [tmin,xfeas]=feasp(lmisys,options); 
% 
% %%
% gama = dec2mat(lmisys,xfeas,gama);
% P0 = dec2mat(lmisys,xfeas,P0);
% Q0 = dec2mat(lmisys,xfeas,Q0);
% R0 = dec2mat(lmisys,xfeas,R0);
% Y01 = dec2mat(lmisys,xfeas,Y01);
% Y02 = dec2mat(lmisys,xfeas,Y02);
% 
% K1_65 = Y01 * inv(R0')
% K2_65 = Y02 * inv(R0')

K1_65 = [-5.65978854359294,-1.17913608525639,-1.12104391506128,-0.920442096342999,-0.920442096341461,0.0318305449558182,-0.0136756943671299,-0.358704382491065,-0.00411253538588253,-0.00246548579690440,0.00147456757328331,-0.00315584642875671,-0.00313993471278626,0.00217893727064142,-0.00290498012957812,-0.00304840836103732,0.00219940099483349,-0.00290498012962209,-0.00304840836102599,0.00219940099481020,0.0269519814880801,0.00195621915289809,-0.000683219910590126,-0.000846059129966656,-0.000846059129696152,-4.02952075944067,-1.18169254635531,-1.35609635854021,-1.13460602020905,-1.13460602020816,-1.72544684408133,-0.964861019380531,-1.24847981493295,-1.04523596142879,-1.04523596142967,-0.659848612521892,-0.656949004975414,-0.860120892352566,-0.714258227353794,-0.714258227353323,-0.262646469589649,-0.373672633381256,-0.477242528918591,-0.393699365537713,-0.393699365537626,-0.110278925585655,-0.172976897062348,-0.213869435983363,-0.175974921097251,-0.175974921096834,-0.0401310250288572,-0.0577396388303399,-0.0690498995552921,-0.0569322687905808,-0.0569322687911119,-0.00614190245930243,-0.00388067068377966,-0.00362418311311486,-0.00313486865506776,-0.00313486865469270,0.00769770739018194,0.0146207939509292,0.0184517440514548,0.0151279312237220,0.0151279312236682;-0.0735079983342504,-6.02320476445086,-1.43067912540996,-0.860494630753423,-0.860494630753385,-0.00411253538573417,-0.00246548579686374,0.00147456757329771,0.0341787712144536,-0.0150492404989309,-0.357196657096132,-0.00527272579723822,-0.00218708276756848,0.00112519147536304,-0.00318587405698112,-0.00303605038570582,0.00211513392779985,-0.00318587405693234,-0.00303605038572619,0.00211513392781870,-0.00348871662245799,0.0259735964055909,0.00227950950753261,-0.00114405300103027,-0.00114405300097006,-0.412042626207047,-4.53084217357321,-1.43967096258379,-1.09625239144247,-1.09625239144165,-0.666450684845820,-2.10641637348321,-1.19938195269802,-1.04467308047514,-1.04467308047393,-0.565809643337876,-0.838008425847541,-0.833896958551157,-0.727860152735403,-0.727860152737434,-0.347637520304527,-0.318292843303597,-0.482799794141747,-0.405371237259788,-0.405371237259752,-0.164028328948906,-0.119995815809243,-0.226654213430483,-0.181904305421744,-0.181904305421323,-0.0542239353573577,-0.0394569248554081,-0.0765925997280286,-0.0587820421738244,-0.0587820421747856,-0.00297266804279606,-0.00479400847673429,-0.00553784356737526,-0.00310722683927329,-0.00310722683938552,0.0141894961831356,0.00892970202145295,0.0190317055370604,0.0156930847055500,0.0156930847055234;-0.713725347216337,-0.0429187995992231,-6.21132452355002,-0.776467686912648,-0.776467686912362,-0.00315584642886559,-0.00313993471285759,0.00217893727060580,-0.00527272579718396,-0.00218708276754411,0.00112519147535986,0.0333093674796857,-0.0150310844462803,-0.357312462864020,-0.00367204054046655,-0.00300730531093799,0.00201124161622401,-0.00367204054032682,-0.00300730531095937,0.00201124161623510,-0.00140624388303758,-0.00389019376286435,0.0259935380238129,-0.00153789770796755,-0.00153789770817070,-0.953067026715409,-0.412965998816961,-4.74587234474178,-1.03775135044563,-1.03775135044067,-0.926725455865358,-0.735927625496247,-2.33881735130638,-1.04083522730099,-1.04083522730415,-0.644376444355705,-0.654272194180955,-1.03004985175487,-0.748331436411179,-0.748331436411258,-0.355464001534936,-0.415130547993694,-0.441535874047937,-0.425265925999863,-0.425265925999590,-0.157622228468596,-0.200701670952285,-0.181438706030429,-0.193200178609828,-0.193200178609943,-0.0502437755125094,-0.0677773040189011,-0.0610144945704990,-0.0628699931066571,-0.0628699931059698,-0.00232404483364328,-0.00432919348772216,-0.00659331712476044,-0.00341124252231433,-0.00341124252236532,0.0137127064206135,0.0171605418189947,0.0140229133644285,0.0166540031608045,0.0166540031606033;-0.689765179396841,-0.814390287453352,-1.07381671993423,-5.79526268815779,-0.857946647438849,-0.00290498012968143,-0.00304840836104519,0.00219940099481340,-0.00318587405686569,-0.00303605038566261,0.00211513392781444,-0.00367204054035454,-0.00300730531093298,0.00201124161622509,0.0313098471285439,-0.0136691553994019,-0.358796813544037,-0.00321565230996784,-0.00303518530371472,0.00211341974159124,-0.00133207952961625,-0.00120892166575402,-0.000888174561139670,0.0269909348874964,-0.00115394072561516,-0.913858344626125,-1.04863388526168,-1.31995391360232,-4.18431827538103,-1.09390511764143,-0.882852880888064,-1.00429478809039,-1.24422527652976,-1.88373208331141,-1.04415087728565,-0.613093611336608,-0.699894749260336,-0.872593854612595,-0.784122989260959,-0.728636813237121,-0.339522150756675,-0.389448998719821,-0.490855870683193,-0.339080348686309,-0.406438704148607,-0.151749520787094,-0.174597476398431,-0.222271656870394,-0.147036018836518,-0.182665502472571,-0.0489769649435578,-0.0563829646243938,-0.0723761281722861,-0.0525701213260461,-0.0591300634705805,-0.00261311832611670,-0.00296988038511806,-0.00403085732413753,-0.00696587337486302,-0.00317614256884204,0.0130824311597427,0.0150666549615209,0.0191079226915983,0.0108211769094836,0.0157415766964962;-0.689765179399607,-0.814390287453726,-1.07381671993374,-0.857946647439855,-5.79526268815772,-0.00290498012966318,-0.00304840836099591,0.00219940099481805,-0.00318587405688144,-0.00303605038568808,0.00211513392782779,-0.00367204054030711,-0.00300730531092791,0.00201124161629272,-0.00321565230996667,-0.00303518530376682,0.00211341974157687,0.0313098471285589,-0.0136691553993432,-0.358796813544099,-0.00133207952983093,-0.00120892166560775,-0.000888174561044735,-0.00115394072559769,0.0269909348870428,-0.913858344625373,-1.04863388526284,-1.31995391360207,-1.09390511764115,-4.18431827537950,-0.882852880889863,-1.00429478808928,-1.24422527653044,-1.04415087728717,-1.88373208331312,-0.613093611335767,-0.699894749260284,-0.872593854611956,-0.728636813235845,-0.784122989261062,-0.339522150756025,-0.389448998720598,-0.490855870683168,-0.406438704149363,-0.339080348686277,-0.151749520787280,-0.174597476398214,-0.222271656870317,-0.182665502472302,-0.147036018836507,-0.0489769649438446,-0.0563829646238353,-0.0723761281725225,-0.0591300634708765,-0.0525701213269384,-0.00261311832618796,-0.00296988038557115,-0.00403085732405777,-0.00317614256866806,-0.00696587337442930,0.0130824311599541,0.0150666549617893,0.0191079226916392,0.0157415766964607,0.0108211769097011];


K2_65 = [-5.66933603651491,-1.18025030054369,-1.12188769891614,-0.921168171183283,-0.921168171182714,0.0313841199198246,-0.0137886502187599,-0.362982833335440,-0.00409681759250982,-0.00245030257429063,0.00159741317642765,-0.00314551805528406,-0.00314322019499290,0.00214928688767856,-0.00289733300971153,-0.00305914412515080,0.00212629649048843,-0.00289733300980670,-0.00305914412515156,0.00212629649044198,0.0270562142274137,0.00195602140950630,-0.000699766785053045,-0.000861720603935966,-0.000861720603554860,-4.03386614921370,-1.18278630968956,-1.35743164759258,-1.13575031381813,-1.13575031381816,-1.72645814728012,-0.965738568730750,-1.24969115669229,-1.04625127067612,-1.04625127067607,-0.660000912759006,-0.657491149388167,-0.860839743616563,-0.714849199717060,-0.714849199716846,-0.262672172237117,-0.373928369552615,-0.477556370533805,-0.393954460356336,-0.393954460356491,-0.110287947799029,-0.173056196568267,-0.213956732833088,-0.176045599109606,-0.176045599108997,-0.0401238554314448,-0.0577363412751623,-0.0690404166691066,-0.0569245303544249,-0.0569245303548289,-0.00612241264100583,-0.00385079511721331,-0.00358560259022243,-0.00310325644830897,-0.00310325644795924,0.00772717561487003,0.0146508868195806,0.0184892778758044,0.0151590235328249,0.0151590235326374;-0.0726759072530486,-6.03349568920501,-1.43193524829963,-0.861057732330911,-0.861057732330696,-0.00409681759233975,-0.00245030257423335,0.00159741317643692,0.0337190942993984,-0.0152056257512311,-0.361829036581595,-0.00525262068232723,-0.00216092274089589,0.00135371640266831,-0.00317600730543697,-0.00304041095824562,0.00208479695383313,-0.00317600730535803,-0.00304041095826686,0.00208479695385227,-0.00351024059005726,0.0260660532823249,0.00227884551174633,-0.00116068053921753,-0.00116068053931930,-0.412281178163422,-4.53593110742715,-1.44096354656075,-1.09733194117429,-1.09733194117246,-0.667172257149404,-2.10781402630564,-1.20047167116843,-1.04569801414293,-1.04569801414314,-0.566361860615412,-0.838248408128466,-0.834596227765333,-0.728473894979947,-0.728473894980543,-0.347910410924110,-0.318301231905477,-0.483140128668052,-0.405639770344455,-0.405639770345316,-0.164113592719741,-0.119980056321199,-0.226763803911041,-0.181979259715888,-0.181979259715292,-0.0542223825833971,-0.0394380155004276,-0.0765909127553196,-0.0587742756007628,-0.0587742756016353,-0.00294457165764287,-0.00476955540291743,-0.00549954578160017,-0.00307452878653171,-0.00307452878664098,0.0142157453221160,0.00896352492510449,0.0190706555427541,0.0157248732343327,0.0157248732342384;-0.714158922814555,-0.0417997619108411,-6.22158030510752,-0.776793096370992,-0.776793096369734,-0.00314551805519754,-0.00314322019500285,0.00214928688763061,-0.00525262068229810,-0.00216092274089212,0.00135371640265996,0.0328530862598801,-0.0151802025137019,-0.361877725634787,-0.00365961628034212,-0.00300513495930876,0.00203189769060082,-0.00365961628031782,-0.00300513495938019,0.00203189769060844,-0.00142295485833758,-0.00391337790074201,0.0260845744544376,-0.00155574358853253,-0.00155574358839051,-0.954022312779249,-0.413113389517312,-4.75108483308557,-1.03872661349476,-1.03872661349189,-0.927646572702722,-0.736721129217983,-2.34043392286607,-1.04186678561893,-1.04186678562051,-0.644920002216607,-0.654926512961378,-1.03047230092719,-0.748979598634851,-0.748979598635294,-0.355695797346106,-0.415470589376924,-0.441645738095872,-0.425558614503244,-0.425558614503548,-0.157684110312229,-0.200814142271422,-0.181459551208879,-0.193284705801711,-0.193284705801205,-0.0502353851122713,-0.0677792104756228,-0.0609977612461836,-0.0628633775279363,-0.0628633775272821,-0.00229516429805366,-0.00429601069603699,-0.00655925179297531,-0.00337693999590136,-0.00337693999635944,0.0137403750553448,0.0171920805405973,0.0140665316228550,0.0166871708253646,0.0166871708254770;-0.690208898219349,-0.814914570924696,-1.07452054142727,-5.80482377787957,-0.858501523035218,-0.00289733300982033,-0.00305914412516191,0.00212629649046292,-0.00317600730534399,-0.00304041095824089,0.00208479695384960,-0.00365961628017345,-0.00300513495928173,0.00203189769060271,0.0308661928254020,-0.0137752221434139,-0.363021828784967,-0.00320575961305763,-0.00303956886927767,0.00208371017556700,-0.00134820268652457,-0.00122548310325187,-0.000905312801441463,0.0270942464971434,-0.00117059586202698,-0.914777897696248,-1.04967022350874,-1.32122127589734,-4.18877121568314,-1.09497984811826,-0.883724595460208,-1.00528221157814,-1.24543561840850,-1.88489509172449,-1.04517505717272,-0.613608227539474,-0.700484920338815,-0.873333774180608,-0.784390525685073,-0.729251844722390,-0.339744463866299,-0.389706553931841,-0.491186948242774,-0.339165778506966,-0.406708663474860,-0.151810888487086,-0.174669150327959,-0.222366796285506,-0.147064866279231,-0.182741260633179,-0.0489702489966524,-0.0563754165860449,-0.0723681111603404,-0.0525630993812739,-0.0591225264006794,-0.00258583286384581,-0.00293847644215529,-0.00399131827554718,-0.00694023192507515,-0.00314339867483404,0.0131090702772849,0.0150971814776718,0.0191465090812602,0.0108566243750487,0.0157734641110164;-0.690208898221479,-0.814914570925108,-1.07452054142504,-0.858501523035215,-5.80482377788086,-0.00289733300978381,-0.00305914412511156,0.00212629649044254,-0.00317600730530327,-0.00304041095824310,0.00208479695386935,-0.00365961628014551,-0.00300513495929585,0.00203189769067392,-0.00320575961299311,-0.00303956886931012,0.00208371017555278,0.0308661928254162,-0.0137752221433388,-0.363021828785012,-0.00134820268663653,-0.00122548310328338,-0.000905312801116388,-0.00117059586202730,0.0270942464966908,-0.914777897695749,-1.04967022350856,-1.32122127589789,-1.09497984811729,-4.18877121568146,-0.883724595460789,-1.00528221157750,-1.24543561840785,-1.04517505717382,-1.88489509172576,-0.613608227539462,-0.700484920338790,-0.873333774180198,-0.729251844721744,-0.784390525685056,-0.339744463865145,-0.389706553932030,-0.491186948242866,-0.406708663474575,-0.339165778507100,-0.151810888487320,-0.174669150327861,-0.222366796285263,-0.182741260633518,-0.147064866279023,-0.0489702489969079,-0.0563754165858991,-0.0723681111605945,-0.0591225264008986,-0.0525630993820536,-0.00258583286404837,-0.00293847644220548,-0.00399131827536720,-0.00314339867456418,-0.00694023192484750,0.0131090702775432,0.0150971814778664,0.0191465090811194,0.0157734641109281,0.0108566243753622];

%% [e(k) Δx(k) X_R(k) ] 65*65
A_R0_1_3 = [    I_N  kron(-H,C*A1)  zeros(5)  kron(M,I_m)  zeros(5,35);
            zeros(15,5)  kron(I_N,A1)  zeros(15,45);
            zeros(45,20)  A_R    ];
A_R0_1_d_3 = [ zeros(5)  kron(-H,C*A1_d)  zeros(5,45);
             zeros(15,5)  kron(I_N,A1_d)  zeros(15,45);
             zeros(45,65)];

A_R0_2_3 = [    I_N  kron(-H,C*A2)  zeros(5)  kron(M,I_m)  zeros(5,35);
            zeros(15,5)  kron(I_N,A2)  zeros(15,45);
            zeros(45,20)  A_R    ];
A_R0_2_d_3 = [ zeros(5)  kron(-H,C*A2_d)  zeros(5,45);
             zeros(15,5)  kron(I_N,A2_d)  zeros(15,45);
             zeros(45,65)];

B_R0_3 = [    kron(-H,C*B);
            kron(I_N,B);
            zeros(45,5) ];
G_hat_3 = eye(65) - B_R0*inv(B_R0'*B_R0)*B_R0';

F_3 = [ kron(-H,C);
      eye(15);
      zeros(45,15)];
D_3 = [ eye(5)  zeros(5,60) ];


Y = zeros(15,1);
  
X= [ kron(-H,C)*Y;
     Y;
     zeros(20,1) ]; % [e x1 x2 x3 r r1 d d1]
 
%%  R(k)
for k=1:1:500
    if k<25
        R(:,k) =zeros(5,1);
    elseif k>=25 & k<=50
        R(:,k) = ( (k-25)/10 )*100*ones(5,1);
    else
        R(:,k) = 2.5*100*ones(5,1);
    end
%       if k<10
%           R(:,k) =zeros(5,1);
%       elseif k>=10 & k<50
%           R(:,k) = 1.5*100*ones(5,1);
%       elseif k>=50 & k<100
%           R(:,k) = 3*100*ones(5,1);
%       elseif k>=100 & k<150
%           R(:,k) = 2*100*ones(5,1);
%       else
%           R(:,k) = 1*100*ones(5,1);
%       end
end

%% 滑模面、控制律、输出
for k=1:1:201
    time(k)=(k-1)/20;
%%
      %预见长度(1,1)
      Y1(:,k)=[Y(1,k) Y(4,k) Y(7,k) Y(10,k) Y(13,k)];
      Y2(:,k)=[Y(2,k) Y(5,k) Y(8,k) Y(11,k) Y(14,k)];
      Y3(:,k)=[Y(3,k) Y(6,k) Y(9,k) Y(12,k) Y(15,k)];
      Tr1(:,k)=kron(I_N,C)*Y(:,k);
      
      if k>1
          % 误差 e
          x11(:,k)= -kron(H,I_m) * (kron(I_N,C)*Y(:,k) - R(:,k));
          % Δx 
          x21(:,k)=Y1(:,k)-Y1(:,k-1);
          x31(:,k)=Y2(:,k)-Y2(:,k-1);
          x41(:,k)=Y3(:,k)-Y3(:,k-1);
      else
          x11(:,k)= -kron(H,I_m) * (kron(I_N,C)*Y(:,k) - R(:,k));
          
          x21(:,k)=Y1(:,k);
          x31(:,k)=Y2(:,k);
          x41(:,k)=Y3(:,k);
      end
      
      % ΔR(k)
      if k==1
          x51(:,k)=R(:,k);
          x61(:,k)=R(:,k+1)-R(:,k);
          x71(:,k)=R(:,k+2)-R(:,k+1);
          x81(:,k)=R(:,k+3)-R(:,k+2);
          x84(:,k)=R(:,k+4)-R(:,k+3);
          x85(:,k)=R(:,k+5)-R(:,k+4);
          x86(:,k)=R(:,k+6)-R(:,k+5);
          x87(:,k)=R(:,k+7)-R(:,k+6);
          x88(:,k)=R(:,k+8)-R(:,k+7);
      else
          x51(:,k)=R(:,k)-R(:,k-1);
          x61(:,k)=R(:,k+1)-R(:,k);
          x71(:,k)=R(:,k+2)-R(:,k+1);
          x81(:,k)=R(:,k+3)-R(:,k+2);
          x84(:,k)=R(:,k+4)-R(:,k+3);
          x85(:,k)=R(:,k+5)-R(:,k+4);
          x86(:,k)=R(:,k+6)-R(:,k+5);
          x87(:,k)=R(:,k+7)-R(:,k+6);
          x88(:,k)=R(:,k+8)-R(:,k+7);
      end
      
      h1(:,k) =  ( 1-1/(2+cos(-0.05*(k-0.5*pi) ) )  ) * ( 1-1/(2+cos(-0.05*(k+0.5*pi) ) )  );
      % h1(:,k) =  ( 1-1/(1+exp(-3*(k-0.5*pi) ) )  ) * ( 1-1/(1+exp(-3*(k+0.5*pi) ) )  );
      h2(:,k) = 1-h1(:,k);
      
      if k>1
         
          S3(:,k) = B_R0_3'*[x11(:,k);x21(:,k);x31(:,k);x41(:,k);x51(:,k);x61(:,k);x71(:,k);x81(:,k);x84(:,k);x85(:,k);x86(:,k);x87(:,k);x88(:,k)] - B_R0_3'* ...
                  (   h1(:,k-1)*h1(:,k-1)*( A_R0_1_3 + B_R0_3*K1_65 )*[x11(:,k-1);x21(:,k-1);x31(:,k-1);x41(:,k-1);x51(:,k-1);x61(:,k-1);x71(:,k-1);x81(:,k-1);x84(:,k-1);x85(:,k-1);x86(:,k-1);x87(:,k-1);x88(:,k-1)] + ...
                      h1(:,k-1)*h2(:,k-1)*( A_R0_1_3 + B_R0_3*K2_65 )*[x11(:,k-1);x21(:,k-1);x31(:,k-1);x41(:,k-1);x51(:,k-1);x61(:,k-1);x71(:,k-1);x81(:,k-1);x84(:,k-1);x85(:,k-1);x86(:,k-1);x87(:,k-1);x88(:,k-1)] + ...
                      h2(:,k-1)*h1(:,k-1)*( A_R0_2_3 + B_R0_3*K1_65 )*[x11(:,k-1);x21(:,k-1);x31(:,k-1);x41(:,k-1);x51(:,k-1);x61(:,k-1);x71(:,k-1);x81(:,k-1);x84(:,k-1);x85(:,k-1);x86(:,k-1);x87(:,k-1);x88(:,k-1)] + ...
                      h2(:,k-1)*h2(:,k-1)*( A_R0_2_3 + B_R0_3*K2_65 )*[x11(:,k-1);x21(:,k-1);x31(:,k-1);x41(:,k-1);x51(:,k-1);x61(:,k-1);x71(:,k-1);x81(:,k-1);x84(:,k-1);x85(:,k-1);x86(:,k-1);x87(:,k-1);x88(:,k-1)]...
                  );
      else
          S3(:,k) = B_R0_3'*[x11(:,k);x21(:,k);x31(:,k);x41(:,k);x51(:,k);x61(:,k);x71(:,k);x81(:,k);x84(:,k);x85(:,k);x86(:,k);x87(:,k);x88(:,k)];
      end
      
      e1=0;
      e2=0;
      
      % Δu(k) 的线性项
      for j=1:1:k
          e1=e1+x11(:,j);
      end

      % Δu(k) 的非线性项
      for j=1:1:k
          for jj=1:1:5
               sat(jj,j)=sign(S3(jj,j));
         end
          %W(:,j) = kron(ones(5,1),(  [ exp(-5*j)*cos(j) ;0]  )   );
          
          if j>1
             if j>4
                W(:,j) = ( h1(:,j)-h1(:,j-1)+h2(:,j)-h2(:,j-1) ) * (  kron(I_N,A1)*[Y1(:,j-1);Y2(:,j-1);Y3(:,j-1)] + kron(I_N,A1_d)*[Y1(:,j-3-1);Y2(:,j-3-1);Y3(:,j-3-1)] ) + ...
                          1*[ 0;0; -0.01*cos(Y(3,j))+0.04*Y(3,j);  0;0; -0.01*cos(Y(6,j))+0.04*Y(6,j);  0;0; -0.01*cos(Y(9,j))+0.04*Y(9,j); 0;0; -0.01*cos(Y(12,j))+0.04*Y(12,j); 0;0; -0.01*cos(Y(15,j))+0.04*Y(15,j) ]; 
                
                %e2=e2 + inv(B_R0_3'*B_R0_3)* (  (0.54-1)*S3(:,j) + 0.5*sat + norm(inv(B_R0_3'*B_R0_3)*B_R0_3'*F_3) * norm( W(:,j)) ) +  0.01*norm( [x21(:,j) zeros(5,1) zeros(5,1) ] );
                
                gbgf=inv(B_R0_3'*B_R0_3)*B_R0_3'*F_3;
                e2=e2 + inv(B_R0_3'*B_R0_3)* (  (0.54-1)*S3(:,j) + 0.5*sat(:,j) + ...
                   [ norm(gbgf(:,1:5)) ,norm(gbgf(:,6:10)) ,norm(gbgf(:,11:15)) ]* [ norm( W(1:5,j)); norm( W(5:10,j)); norm( W(11:15,j)) ] )...
                   +  0.01*norm( [x21(:,j) zeros(5,1) zeros(5,1) ] ) ;
             else
                 W(:,j) = ( h1(:,j)-h1(:,j-1)+h2(:,j)-h2(:,j-1) ) * (  kron(I_N,A1)*[Y1(:,j-1);Y2(:,j-1);Y3(:,j-1)] ) + ...
                          1*[ 0;0; -0.01*cos(Y(3,j))+0.04*Y(3,j);  0;0; -0.01*cos(Y(6,j))+0.04*Y(6,j);  0;0; -0.01*cos(Y(9,j))+0.04*Y(9,j); 0;0; -0.01*cos(Y(12,j))+0.04*Y(12,j); 0;0; -0.01*cos(Y(15,j))+0.04*Y(15,j) ] ;
                
                %e2=e2 + inv(B_R0_3'*B_R0_3)* (  (0.54-1)*S3(:,j) + 0.5*sat + norm(inv(B_R0_3'*B_R0_3)*B_R0_3'*F_3) * norm( W(:,j)) ) +  0.01*norm( [x21(:,j) zeros(5,1) zeros(5,1) ] );
                
                gbgf=inv(B_R0_3'*B_R0_3)*B_R0_3'*F_3;
                e2=e2 + inv(B_R0_3'*B_R0_3)* (  (0.54-1)*S3(:,j) + 0.5*sat(:,j) + ...
                   [ norm(gbgf(:,1:5)) ,norm(gbgf(:,6:10)) ,norm(gbgf(:,11:15)) ]* [ norm( W(1:5,j)); norm( W(5:10,j)); norm( W(11:15,j)) ] )...
                   +  0.01*norm( [x21(:,j) zeros(5,1) zeros(5,1) ] ) ;
             end
             
          else
               W(:,j) = 1*[ 0;0; -0.01*cos(Y(3,j))+0.04*Y(3,j);  0;0; -0.01*cos(Y(6,j))+0.04*Y(6,j);  0;0; -0.01*cos(Y(9,j))+0.04*Y(9,j); 0;0; -0.01*cos(Y(12,j))+0.04*Y(12,j); 0;0; -0.01*cos(Y(15,j))+0.04*Y(15,j) ];
               
              %e2=e2 + inv(B_R0_3'*B_R0_3)* (  (0.54-1)*S3(:,j) + 0.5*sat + norm(inv(B_R0_3'*B_R0_3)*B_R0_3'*F_3) * norm( W(:,j)) ) + 0.01*norm([x21(:,j) zeros(5,1) zeros(5,1) ]);
              
              gbgf=inv(B_R0_3'*B_R0_3)*B_R0_3'*F_3;
                e2=e2 + inv(B_R0_3'*B_R0_3)* (  (0.54-1)*S3(:,j) + 0.5*sat(:,j) + ...
                   [ norm(gbgf(:,1:5)) ,norm(gbgf(:,6:10)) ,norm(gbgf(:,11:15)) ]* [ norm( W(1:5,j)); norm( W(5:10,j)); norm( W(11:15,j)) ] )...
                   +  0.01*norm( [x21(:,j) zeros(5,1) zeros(5,1) ] ) ;
          end
      end
      
      if k>3
         U3(:,k)=( h1(:,k)*K1_65+h2(:,k)*K2_65 ) * [e1;Y1(:,k);Y2(:,k);Y3(:,k);R(:,k);R(:,k+1);R(:,k+2);R(:,k+3);R(:,k+4);R(:,k+5);R(:,k+6);R(:,k+7);R(:,k+8)] - ...
                 ( h1(:,k)*inv(B_R0_3'*B_R0_3)*B_R0_3'*A_R0_1_d +  h2(:,k)*inv(B_R0_3'*B_R0_3)*B_R0_3'*A_R0_2_d ) *...
                 [ e1;Y1(:,k-3);Y2(:,k-3);Y3(:,k-3);R(:,k-3);R(:,k+1-3);R(:,k+2-3);R(:,k+3-3);R(:,k+4-3);R(:,k+5-3);R(:,k+6-3);R(:,k+7-3);R(:,k+8-3) ] -e2 ;
             
         Y(:,k+1) =  h1(:,k) * (  kron(I_N,A1)*Y(:,k) + kron(I_N,A1_d)*Y(:,k-3) + kron(I_N,B)*( U3(:,k)+0.01*[sin(Y(1,k));sin(Y(4,k)); sin(Y(7,k)); sin(Y(10,k)); sin(Y(13,k)) ] ) ...
                      + 1*[ 0;0; -0.01*cos(Y(3,k))+0.04*Y(3,k);  0;0; -0.01*cos(Y(6,k))+0.04*Y(6,k);  0;0; -0.01*cos(Y(9,k))+0.04*Y(9,k); 0;0; -0.01*cos(Y(12,k))+0.04*Y(12,k); 0;0; -0.01*cos(Y(15,k))+0.04*Y(15,k) ]   ) +...
                      h2(:,k) * (  kron(I_N,A2)*Y(:,k) + kron(I_N,A2_d)*Y(:,k-3) + kron(I_N,B)*( U3(:,k)+0.01*[sin(Y(1,k)); sin(Y(4,k)); sin(Y(7,k)); sin(Y(10,k)); sin(Y(13,k)) ] )...
                      + 1*[ 0;0; -0.01*cos(Y(3,k))+0.04*Y(3,k);  0;0; -0.01*cos(Y(6,k))+0.04*Y(6,k);  0;0; -0.01*cos(Y(9,k))+0.04*Y(9,k); 0;0; -0.01*cos(Y(12,k))+0.04*Y(12,k); 0;0; -0.01*cos(Y(15,k))+0.04*Y(15,k) ] ) ;
      else
          U3(:,k)=( h1(:,k)*K1_65+h2(:,k)*K2_65 ) * [e1;Y1(:,k);Y2(:,k);Y3(:,k);R(:,k);R(:,k+1);R(:,k+2);R(:,k+3);R(:,k+4);R(:,k+5);R(:,k+6);R(:,k+7);R(:,k+8)] - e2 ;
          
          Y(:,k+1) =  h1(:,k) * (  kron(I_N,A1)*Y(:,k) + kron(I_N,B)*( U3(:,k)+0.01*[sin(Y(1,k)); sin(Y(4,k)); sin(Y(7,k)); sin(Y(10,k)); sin(Y(13,k)) ] )...
                      + 1*[ 0;0; -0.01*cos(Y(3,k))+0.04*Y(3,k);  0;0; -0.01*cos(Y(6,k))+0.04*Y(6,k);  0;0; -0.01*cos(Y(9,k))+0.04*Y(9,k); 0;0; -0.01*cos(Y(12,k))+0.04*Y(12,k); 0;0; -0.01*cos(Y(15,k))+0.04*Y(15,k) ] ) + ...
                      h2(:,k) * (  kron(I_N,A2)*Y(:,k) + kron(I_N,B)*( U3(:,k)+0.01*[sin(Y(1,k)); sin(Y(4,k)); sin(Y(7,k)); sin(Y(10,k)); sin(Y(13,k)) ] )...
                      + 1*[ 0;0; -0.01*cos(Y(3,k))+0.04*Y(3,k);  0;0; -0.01*cos(Y(6,k))+0.04*Y(6,k);  0;0; -0.01*cos(Y(9,k))+0.04*Y(9,k); 0;0; -0.01*cos(Y(12,k))+0.04*Y(12,k); 0;0; -0.01*cos(Y(15,k))+0.04*Y(15,k) ] ) ;
      end
     
end

%% R1(k)
for k=1:1:201
    if k<25
       R1(:,k) =zeros(5,1);
    elseif k>=25 & k<=50
        R1(:,k) = ( (k-25)/10 )*100*ones(5,1);
    else
       R1(:,k) = 2.5*100*ones(5,1);
    end
%       if k<10
%           R1(:,k) =zeros(5,1);
%       elseif k>=10 & k<50
%           R1(:,k) = 1.5*100*ones(5,1);
%       elseif k>=50 & k<100
%           R1(:,k) = 3*100*ones(5,1);
%       elseif k>=100 & k<150
%           R1(:,k) = 2*100*ones(5,1);
%       else
%           R1(:,k) = 1*100*ones(5,1);
%       end
end

%% 
figure(1);
plot(time,R1(1,:)/100,'k-',time,Tr1(1,:)/100,time,Tr1(2,:)/100,time,Tr1(3,:)/100,time,Tr1(4,:)/100,time,Tr1(5,:)/100,'LineWidth',1);
xlabel('time(s)','FontName','Times New Roman','FontSize',12);
ylabel('output response','FontName','Times New Roman','FontSize',12);
f1=legend('$r_{k}$','agent1','agent2','agent3','agent4','agent5','Location','NorthWest','FontName','Times New Roman');
set(f1,'Interpreter','latex','fontsize',10);

axes('Position',[0.4,0.5,0.5,0.2]); % 生成子图   
plot(time,R1(1,:)/100,'k-',time,Tr1(1,:)/100,time,Tr1(2,:)/100,time,Tr1(3,:)/100,time,Tr1(4,:)/100,time,Tr1(5,:)/100,'LineWidth',1);
ylim([1.7411,1.7412]); % 放大的横坐标
xlim([2.06,2.21]); % 放大的横坐标

figure(2);
plot(time,S3(1,:)/100,time,S3(2,:)/100,time,S3(3,:)/100,time,S3(4,:)/100,time,S3(5,:)/100,'LineWidth',1);
xlabel('time(s)','FontName','Times New Roman','FontSize',12);
ylabel('sliding mode surface ','FontName','Times New Roman','FontSize',12);
legend('agent1','agent2','agent3','agent4','agent5','FontName','Times New Roman','FontSize',10);

figure(3);
plot(time,U3(1,:)/100,time,U3(2,:)/100,time,U3(3,:)/100,time,U3(4,:)/100,time,U3(5,:)/100,'LineWidth',1);
xlabel('time(s)','FontName','Times New Roman','FontSize',12);
ylabel('control input','FontName','Times New Roman','FontSize',12);
legend('agent1','agent2','agent3','agent4','agent5','FontName','Times New Roman','FontSize',10);

axes('Position',[0.4,0.4,0.5,0.2]); % 生成子图   
plot(time,U3(1,:)/100,time,U3(2,:)/100,time,U3(3,:)/100,time,U3(4,:)/100,time,U3(5,:)/100,'LineWidth',1);
ylim([-33.8516,-33.851]); % 放大的横坐标
xlim([1.90,1.99]); % 放大的横坐标

figure(4);
plot(time,x11(1,:)/100,time,x11(2,:)/100,time,x11(3,:)/100,time,x11(4,:)/100,time,x11(5,:)/100,'LineWidth',1);
xlabel('time(s)','FontName','Times New Roman','FontSize',12);
ylabel('tracking error','FontName','Times New Roman','FontSize',12);
legend('agent1','agent2','agent3','agent4','agent5','FontName','Times New Roman','FontSize',10);


%% 第一个智能体系统在不同预见长度下的跟踪
%   0预见
Tr0 = [0,0.000291274563830439,-0.00447568443310874,0.00323835157818310,-0.000350290078472406,-0.0102520100016423,-0.00397637373651053,0.00802110308930895,0.00335767764171525,-0.00789316238385581,-0.00246062227757160,0.00950845036175404,0.00470027978259457,-0.000737005907748883,-0.00116518275390566,0.00274594883118993,0.00278302677675959,-0.000454185161179347,0.000108727876367246,0.00369790388908022,0.00346884873906800,0.000134062825680464,0.000616017466402876,0.00415663369789490,0.00384810006957685,0.000447923211669937,2.83070621317307,5.99526992757104,9.90865800762864,14.4944514523625,19.8485141498540,25.7873658428041,32.2902689079976,39.2506310931438,46.6319921428537,54.3652704684041,62.4136971671962,70.7306407109182,79.2832313169350,88.0370816919052,96.9676663094065,106.048755872710,115.260764810674,124.586099937314,134.008276645412,143.515679035543,153.094005497604,162.735156699077,172.429616239531,182.170302728719,191.949470007505,198.932742379110,205.615783156684,211.575746717523,216.878444956932,221.430805362435,225.411088802566,228.840174855878,231.823867790039,234.396983523615,236.626874910872,238.547778778721,240.209285593552,241.642327096866,242.878302640849,243.943749402661,244.860748553646,245.651399302879,246.332648640184,246.917653866140,247.420814474841,247.852521860628,248.224598693647,248.541932346535,248.814012084272,249.046886253654,249.244767026838,249.413296921078,249.556868210133,249.678820648753,249.782641874212,249.870035153384,249.943760217577,250.006337298535,250.047843203672,250.083303830189,250.119608698112,250.147593461556,250.170382705576,250.186619510386,250.200791458255,250.212790000961,250.222688027197,250.230018655460,250.235965568473,250.241335621155,250.246553035502,250.251444509934,250.255744942028,250.259296430941,250.262186166018,250.264637585505,250.266877084410,250.269074551610,250.271335988909,250.273711072967,250.276198746755,250.278764577807,250.281361225981,250.283950478573,250.286514414139,250.289056420856,250.291593829092,250.294149474723,250.296745379157,250.299399713008,250.302125669611,250.304931457934,250.307820752408,250.310793511639,250.313847021206,250.316977081996,250.320179195661,250.323449609143,250.326786088372,250.330188350630,250.333658149352,250.337199067858,250.340816112715,250.344515200758,250.348302614715,250.352184474456,250.356166248287,250.360252318296,250.364445617286,250.368747369745,250.373156990906,250.377672219802,250.382289577970,250.387005257469,250.391816648762,250.396726439143,250.401749477583,250.406894054212,250.412176016100,250.417619129479,250.423252078722,250.429102713418,250.435191261419,250.441520907362,250.448069671314,250.454787460179,250.461603209100,250.468442836162,250.475252970392,250.482020147308,250.488775655063,250.495581305961,250.502497446769,250.509540883006,250.516649712723,250.523680300108,250.530452582895,250.536824374821,250.542742652678,250.548235212237,250.553355948450,250.558122360754,250.562474246439,250.566270020707,250.569325308639,250.571474533362,250.572617740025,250.572729477678,250.571839593954,250.570008787560,250.567311664390,250.563829106506,250.559647865324,250.554864644653,250.549591761979,250.543961022985,250.538122836153,250.532239617153,250.526474823398,250.520979917834,250.515881241095,250.511268277145,250.507184669614,250.503623228083,250.500525697445,250.497787339803,250.495265695326,250.492792442461,250.490187075425,250.487271079063,250.483881369704,250.479881991912,250.475173365237,250.469698609956,250.463446491129];

%   1预见 L2_cc2_5的Tr1
Tr1 = [0,0.000291274563830439,-0.00447538065218564,0.00321763154525281,-0.00196142245721724,-0.0101637186504787,0.000137705797465536,0.0105158414653473,0.000491530029422220,-0.00906517904406693,0.00146807395275360,0.0118583140343397,0.00146997345210727,-0.00837439033060879,0.00202913343650087,0.0122990503494185,0.00180713298898027,-0.00811268277835207,0.00224109229062666,0.0124628957137467,0.00193539863027907,-0.00801607917533296,0.00232224604249235,0.0125249705427099,0.00198376298914681,3.83851345704530,8.26187412707327,13.5548936470207,19.7776637132615,26.8250398503212,34.3666374304251,42.4424121422077,50.8857457571770,59.6713359249533,68.6840197656585,77.9182021072876,87.3024107044705,96.8264063562283,106.444304027183,116.153486397011,125.921176468204,135.746652305952,145.610995414034,155.508231070151,165.430591111075,175.373199362387,185.332883091593,195.303615172630,205.284296617640,215.273307487685,221.420575470443,227.004541338879,231.724581267836,235.504946948376,238.462604106521,240.921406577085,242.850620456024,244.409517130644,245.631508408108,246.623518119479,247.398255850601,248.020990918346,248.509724070780,248.900263021156,249.208385187921,249.452444865621,249.644304218678,249.797095007263,249.916346049218,250.010354943708,250.084006283480,250.130013551867,250.172378536328,250.199017046490,250.219985188279,250.234233991493,250.243934646988,250.249593464092,250.251533275932,250.252099901605,250.250326978502,250.248035664098,250.244034824192,250.240007089496,250.234897195419,250.230208375855,250.225142479640,250.220850323992,250.216578649897,250.212972556306,250.209338466334,250.206064465670,250.202754857125,250.199811779577,250.197139389950,250.195055134492,250.193468775026,250.192453929219,250.191852401386,250.191608955355,250.191597386796,250.191756364939,250.192036998080,250.192417274871,250.192915782430,250.193533633831,250.194309728446,250.195230850931,250.196325910366,250.197562965304,250.198963217697,250.200486734499,250.202149893771,250.203909594306,250.205776617593,250.207708686425,250.209713220179,250.211754444122,250.213840882782,250.215947532953,250.218086751137,250.220244562862,250.222436456415,250.224656494853,250.226920794421,250.229227840897,250.231592238692,250.234014297319,250.236506033680,250.239068075611,250.241709462958,250.244430181235,250.247236042263,250.250125528952,250.253100896174,250.256158454085,250.259298039543,250.262526700937,250.265839565385,250.269227309408,250.272686938612,250.276215752725,250.279815687430,250.283494283730,250.287266937096,250.291155234587,250.295185872174,250.299385141864,250.303772040017,250.308348633720,250.313092381636,250.317953367420,250.322862004790,250.327747442564,250.332561769936,250.337299093966,250.341999414055,250.346732768317,250.351565778094,250.356519271684,250.361533571876,250.366465530824,250.371132559968,250.375386402675,250.379167683880,250.382505943363,250.385473884500,250.388126941087,250.390453970922,250.392361872271,250.393707274258,250.394358737752,250.394245292658,250.393361230777,250.391739676177,250.389426820984,250.386471624653,250.382927886738,250.378862371044,250.374363754047,250.369547092042,250.364550949737,250.359528065345,250.354632814662,250.350008569793,250.345776675069,250.342027340191,250.338812434054,250.336140548869,250.333975117546,250.332236185422,250.330805972569,250.329537815805,250.328267678740,250.326827091246,250.325056206303,250.322815711308,250.319996698701,250.316527948010,250.312380210320,250.307567117252];

%   8预见 
Tr2 = [0,0.000291274563830439,-0.00449531146719460,0.00355442167467784,-0.00217647094835751,-0.0101759340042524,0.000157178948593054,0.0100744774966813,0.000258418358608802,-0.00872841633747148,0.00148927747712788,0.0113870436265863,0.00131505280460322,-0.00796499838089144,0.00211701106208482,0.0118793445722537,0.00171055737763625,-0.00765488694939220,-0.0260750969987519,-0.00467861763939301,0.0861052506150118,0.407039483447602,1.18962959095120,2.74280807139799,5.46846644543831,9.72048242923805,15.0058593423780,21.0862129904429,27.8272958747135,35.1688935452256,42.9865299699516,51.2110441227275,59.7619004422845,68.5872533998829,77.6315647298022,86.8586352355542,96.2330141290123,105.729517714236,115.325476015881,124.999066440092,134.740812370203,144.534352907838,154.370321880637,164.270690467433,174.161443192022,183.982843101803,193.595241418249,202.776374944177,211.200486145766,218.457051167024,224.195695361073,228.904809358767,232.822102784353,236.079962168917,238.737108651495,240.919786035373,242.695745467473,244.146658053675,245.325982311313,246.285787291221,247.064854924490,247.695369678280,248.209316071353,248.624023093854,248.959802583898,249.232858203951,249.453749523942,249.632118247532,249.777282237301,249.894454184669,249.988434509729,250.064139606748,250.114742109712,250.162876213013,250.195092756358,250.221675387930,250.241809309803,250.256501589843,250.267450797522,250.274192656026,250.279729872500,250.282050516509,250.283584579880,250.282573325089,250.281223635765,250.278254889678,250.275516305399,250.271986005748,250.268926755407,250.265412846197,250.262224160538,250.258660494504,250.255321115066,250.251844113985,250.248766956296,250.245896378912,250.243548972389,250.241474811516,250.239767090226,250.238186319467,250.236780359125,250.235423592731,250.234194948218,250.233063463191,250.232111344056,250.231336451874,250.230784723913,250.230441775512,250.230312987518,250.230372763109,250.230606425068,250.230989250905,250.231501286776,250.232122662026,250.232833868567,250.233620301352,250.234466255159,250.235363387970,250.236302309220,250.237281516501,250.238298251241,250.239356438140,250.240457928398,250.241609338897,250.242814488438,250.244080327017,250.245410794984,250.246811874498,250.248286716029,250.249839786648,250.251473007616,250.253189026906,250.254988164124,250.256870964683,250.258835988331,250.260882240507,250.263008083110,250.265211371544,250.267486438403,250.269827417835,250.272229162206,250.274689476511,250.277210374401,250.279800476044,250.282475684719,250.285259525887,250.288180793201,250.291269198670,250.294547758763,250.298023882502,250.301681157005,250.305476902892,250.309349313621,250.313235443284,250.317094281006,250.320924870296,250.324769736903,250.328700065280,250.332785074137,250.337053609260,250.341462850057,250.345895796347,250.350202189572,250.354267626983,250.358065987458,250.361660315924,250.365156817606,250.368638976987,250.372110196887,250.375474010201,250.378568348844,250.381233581108,250.383366032823,250.384926299601,250.385914788661,250.386345116180,250.386231828573,250.385590586823,250.384442357827,250.382816618597,250.380753787792,250.378307677183,250.375547136840,250.372555925310,250.369430526694,250.366275917253,250.363199311382,250.360302157646,250.357671178917,250.355369720180,250.353430795323,250.351852962885,250.350599674252,250.349602200883,250.348765743436,250.347977847813,250.347117955342,250.346067282953,250.344718774679,250.342986266186,250.340811477008];

figure(5);
plot(time,R1(1,:)/100,'k-',time,Tr0/100,time,Tr1/100,time,Tr2/100,'LineWidth',1);
xlabel('time(s)','FontName','Times New Roman','FontSize',12);
ylabel('output response','FontName','Times New Roman','FontSize',12);
f11=legend('$r_{k}$','$\ell_{p}=0$','$\ell_{p}=1$','$\ell_{p}=8$');
set(f11,'Interpreter','latex','fontsize',10);

axes('Position',[0.4,0.5,0.2,0.2]); % 生成子图   
plot(time,R1(1,:)/100,'k-',time,Tr0/100,time,Tr1/100,time,Tr2/100,'LineWidth',1);               
xlim([1.5,1.6]); % 放大的横坐标

%% 第一个智能体系统在不同预见长度下的误差
%   0预见
x11_0 = [0,-0.000290897088181232,0.00454994533328344,-0.0392960321772085,0.00506316044338442,0.0660324036907100,0.0100429018039839,-0.0574735705230933,-0.00576595381326371,0.0618181265564688,0.00912222654820954,-0.0593676839664205,-0.0176679748835727,0.0230512559003752,0.0114908764895500,-0.0189614929550459,-0.00546437517062559,0.0222113084409526,0.00643810986222635,-0.0221068805332971,-0.00730081359073474,0.0206620227889549,0.00515541042015965,-0.0232863063727819,-0.00818989247272899,10.0199810047967,16.3087214774295,25.1953919285854,34.0314780754638,42.4521188259679,49.6105563753602,56.1267353951376,61.7559153119883,66.7720386690660,71.1164037630497,74.9342967100065,78.2401163118578,81.1220748573995,83.6019921450840,85.7581568486895,87.6162232118673,89.2261143547065,90.6164614410214,91.8095529568672,92.8402520112469,93.7206502468703,94.4811010527569,95.1319097864001,95.6881625837680,96.1630494040878,86.5730741372553,80.6441758396552,72.0379138555189,63.4392074166626,55.2402625579369,48.2657842198399,41.9065972968371,36.4172774508163,31.5093252504087,27.2594468466967,23.5188983337634,20.2863764747454,17.4596821172239,15.0077629716593,12.8845150072142,11.0449293540757,9.45752395742741,8.08139369912115,6.89158158078922,5.86815978090377,4.98602390991314,4.22774968876630,3.56781502883274,3.00757345770703,2.52453793743703,2.10787833227465,1.75580379608590,1.45599432105388,1.19701734715181,0.975521815177757,0.784427950587002,0.625997694957277,0.489652832173704,0.368814318030189,0.325081350882385,0.246735097514744,0.149990454836171,0.0813123117530665,0.0274431986104275,-0.00144896105157954,-0.0302981377332117,-0.0579508984132531,-0.0819901018766984,-0.0972620547260306,-0.108564591295959,-0.119384218245017,-0.131430181388282,-0.143536964966415,-0.154139440923245,-0.162257779707119,-0.168140928252683,-0.172679691934604,-0.176726784223234,-0.180848310664402,-0.185323892474543,-0.190220961048823,-0.195430391587479,-0.200746231427502,-0.205942457299500,-0.210853921425922,-0.215409450348147,-0.219628012554836,-0.223583840629885,-0.227372180474987,-0.231085483621484,-0.234803102965117,-0.238587097900563,-0.242481219497023,-0.246510948288829,-0.250685010548864,-0.254998130200534,-0.259434907426368,-0.263974227830261,-0.268593580883220,-0.273272639674815,-0.277995689152164,-0.282752772872243,-0.287539720950889,-0.292357396931976,-0.297210540390552,-0.302106517058235,-0.307054174503037,-0.312062896917382,-0.317141880608546,-0.322299618022697,-0.327543571124636,-0.332880023076342,-0.338314108444166,-0.343850030114140,-0.349491479106433,-0.355242369546261,-0.361109563455415,-0.367105144611372,-0.373219488938588,-0.379462843283648,-0.385852059102803,-0.392402619718865,-0.399121193752251,-0.406006618404206,-0.413046449692928,-0.420217750596208,-0.427491257524480,-0.434841888243341,-0.442260641051007,-0.449760999314094,-0.457372408824995,-0.465120885039823,-0.473004409741776,-0.480972891686832,-0.488920925040077,-0.496702322162719,-0.504173924241826,-0.511257268888159,-0.517972812576659,-0.524398985351155,-0.530574092866516,-0.536425236711324,-0.541777972245995,-0.546419097514843,-0.550163051352911,-0.552899364757423,-0.554608856370464,-0.555338183291724,-0.555148642406266,-0.554077642816623,-0.552131193627474,-0.549294880407246,-0.545549300776258,-0.540887429674285,-0.535334314297131,-0.528966119632514,-0.521921489171405,-0.514398137618315,-0.506633924773837,-0.498879167285310,-0.491368821877586,-0.484299600075360,-0.477813388607729,-0.471987301864942,-0.466830701991569,-0.462288891928012,-0.458252117135231,-0.454567909608272,-0.451055005703495,-0.447517670455852,-0.443759724353072,-0.439597706409529,-0.434872561423049,-0.429459175493378,-0.423273050410842,-0.416273415162607];

%   1预见 L2_cc2_5的Tr1
x11_1 = [0,-0.000290897088181232,0.00457003886804486,-0.0397013518568081,0.0187272378640163,0.0670988940924502,-0.00612016620493349,-0.0609378059034046,0.0126565129902012,0.0650883053377351,-0.0100093060276316,-0.0650610449061492,0.0100293651274491,0.0633483404606885,-0.0115257987677789,-0.0661881005441480,0.00916877587553748,0.0627086702895413,-0.0120560235009306,-0.0665628158237814,0.00886240490700379,0.0625030811027156,-0.0122535412058005,-0.0666946621782332,0.00874918198898486,5.64091527718040,15.2365054191522,23.3424178729192,29.9830075057950,35.0489453629977,39.8552842348071,43.3995595537510,46.4938933590438,48.8060623000473,50.8321341425079,52.3264092654601,53.6177985143504,54.5747838737168,55.4010991817157,56.0020316498433,56.5210035982418,56.8926782747325,57.2026971168786,57.4380514683910,57.6233317918106,57.7681642582586,57.8713004702339,57.9585596356160,58.0187560723554,58.0593532680599,52.5101198757433,42.8943405702002,34.7792540495005,28.1565431952234,23.0931875734290,18.2977103445113,14.7492520833317,11.6629798021097,9.34038194472018,7.30987984206811,5.80329859169311,4.51278671986063,3.54087377188591,2.71923526530648,2.09269157463436,1.57638252829534,1.18402213680622,0.856683929621681,0.610565853947037,0.405563990803188,0.247450658019346,0.160390493583776,0.0392539086213048,-0.0290401035485104,-0.0782453297005077,-0.122844859692691,-0.148937428871960,-0.174099437906307,-0.180622005530040,-0.193846413779312,-0.193084965278814,-0.199213363380693,-0.194340665519690,-0.195921134419365,-0.189407703977849,-0.188362089423094,-0.181779481145043,-0.179467157417434,-0.173503847404447,-0.170595332244091,-0.165419036099195,-0.162426814292047,-0.158173080740937,-0.155536151827164,-0.152325903643543,-0.150292373010132,-0.148055517244558,-0.146608899450172,-0.145256100234803,-0.144553940586917,-0.144267812371794,-0.144561429701014,-0.145347550188262,-0.146454454815029,-0.147865206302129,-0.149301115362704,-0.150897774581978,-0.152399666438754,-0.154061355407549,-0.155641354870028,-0.157440655828509,-0.159215916396988,-0.161262819095128,-0.163334663458329,-0.165687995007659,-0.168080369715256,-0.170714584564337,-0.173366331465473,-0.176190553279497,-0.178997403614858,-0.181910479641402,-0.184783841807615,-0.187722092295957,-0.190620662609263,-0.193569047599198,-0.196494459681503,-0.199471363054244,-0.202448885261504,-0.205486720855845,-0.208548576067187,-0.211680667661113,-0.214856373641226,-0.218110232026248,-0.221421971828335,-0.224816255403226,-0.228276925433477,-0.231821623155184,-0.235448143617418,-0.239147464236083,-0.242912714882692,-0.246762690354188,-0.250694807111245,-0.254714689459263,-0.258824517677340,-0.263035752913709,-0.267356534788746,-0.271800408845138,-0.276376159823116,-0.281089501376982,-0.285934728512814,-0.290896046249685,-0.295947402816324,-0.301061502757079,-0.306218807178027,-0.311414502829223,-0.316655728065570,-0.321950474502614,-0.327294666631190,-0.332661614486227,-0.337996838273767,-0.343219121139839,-0.348237951626743,-0.352985539655691,-0.357443343347626,-0.361631723472982,-0.365573034383090,-0.369260719423664,-0.372645762729292,-0.375629346240146,-0.378077626010395,-0.379866025482784,-0.380921146438709,-0.381213949170729,-0.380717415651304,-0.379388886742618,-0.377200484571233,-0.374171713413517,-0.370369978691429,-0.365892748410943,-0.360854697916750,-0.355381512327256,-0.349605615549876,-0.343662422672082,-0.337688978659173,-0.331823853167123,-0.326205250468718,-0.320963821661763,-0.316210448869157,-0.312022323886794,-0.308431849012806,-0.305420833151942,-0.302920626093822,-0.300817426277035,-0.298961773654980,-0.297180926503899,-0.295292836560947,-0.293120399389039,-0.290504908576139,-0.287317538696982,-0.283467754109523,-0.278907908916779];

%   8预见 
x11_2 = [0,-0.000290897088181232,0.00459364500820321,-0.0402342769162320,0.0191047663658517,0.0658808025979559,-0.00524076681171186,-0.0587737551257189,0.0119520380981905,0.0629191661278372,-0.00867997107685095,-0.0625882385356179,0.00904542602173986,0.0610725508436607,-0.0102921427711104,-0.0637611479835503,0.00807585969311681,0.0603714244797060,0.0114380543068026,-0.102529400714843,-0.110542442177441,-0.126507527673928,-0.263486305657830,-0.540320500965417,-1.27985775709387,6.78420242304774,14.0334238534296,20.4066833912085,26.0020476282056,30.6263003167278,34.5504044197367,37.7723622959640,40.4624806232968,42.6440676027432,44.4573236455224,45.9340697221612,47.1484955563447,48.1312524471757,48.9313650366484,49.5935055094052,50.1129996380938,50.5420030281659,50.8880849818100,51.1409990914065,51.4169393893671,51.6434374521914,51.8598626457658,52.0750432217407,52.4030950880995,53.1938111096964,45.1546576873066,37.9199148941873,31.5563027285289,25.9667935534929,21.3537783140049,17.4328562641385,14.2177718070065,11.5386300850832,9.34598410628479,7.53769570633588,6.06056225043861,4.86347088807193,3.87037602888969,3.07540980869217,2.42645757929117,1.89593604527815,1.46448756820382,1.11508341573898,0.827662528928613,0.593513787522710,0.403257554483645,0.247820709581589,0.150792175596933,0.0186809854751289,-0.0633286483928259,-0.130337903692833,-0.190913286264248,-0.232472685968418,-0.274468109394178,-0.297901838335122,-0.328093639206173,-0.342089337360932,-0.361290941962665,-0.367181988689282,-0.377544104496195,-0.378171733596815,-0.382674570971744,-0.380256824657295,-0.380777668542635,-0.376427077746769,-0.374296041371224,-0.368876178406026,-0.365105763089446,-0.359069616683144,-0.354159536391251,-0.347634049934385,-0.341776363003362,-0.334728862023212,-0.328108816998508,-0.320862441011144,-0.314223744760056,-0.307604899995312,-0.301741723117289,-0.296124228747658,-0.291053521757874,-0.286125363138751,-0.281476574148485,-0.276877728605314,-0.272416533340078,-0.267997508149676,-0.263683930095738,-0.259463963298913,-0.255382589443599,-0.251465314349844,-0.247730168207539,-0.244198953241465,-0.240854776670659,-0.237698475641935,-0.234689013369916,-0.231815949056454,-0.229035981417070,-0.226342543289462,-0.223703520452517,-0.221121161086273,-0.218575584000831,-0.216074895038929,-0.213607224271726,-0.211182193014679,-0.208791837238039,-0.206444420870810,-0.204133337148477,-0.201864193472176,-0.199630439066482,-0.197434713816364,-0.195270101479281,-0.193136939964461,-0.191028527666248,-0.188941808263394,-0.186867630575819,-0.184805392599912,-0.182753166285295,-0.180713536258281,-0.178689446050583,-0.176691219251723,-0.174733392749744,-0.172838688869490,-0.171033942522570,-0.169349722189139,-0.167813656353218,-0.166447251086879,-0.165261788641658,-0.164261985863874,-0.163453816829531,-0.162856596647146,-0.162508157884105,-0.162458294451767,-0.162750040409975,-0.163401278715554,-0.164397977071673,-0.165704426973321,-0.167286025491279,-0.169138400119863,-0.171314494361468,-0.173936177658391,-0.177180207052942,-0.181250036218614,-0.186347816401650,-0.192632935175141,-0.200162642146978,-0.208862408175378,-0.218566420895087,-0.229087191186295,-0.240236808549327,-0.251791882878081,-0.263471365991364,-0.274972664791619,-0.286034711089087,-0.296469866922990,-0.306141823937082,-0.314915385750339,-0.322621480758642,-0.329058375142978,-0.334022621750506,-0.337354077162900,-0.338981104838780,-0.338955060711214,-0.337466328674509,-0.334838537794212,-0.331502657462835,-0.327956519246555,-0.324716944373279,-0.322271300983459,-0.321034052381606,-0.321312432686767,-0.323284032449266,-0.326987647097013,-0.332327389902133,-0.339089128190182,-0.346966772897360,-0.355593653336200,-0.364574628797698];

figure(6);
plot(time,x11_0/100,time,x11_1/100,time,x11_2/100,'LineWidth',1);
xlabel('time(s)','FontName','Times New Roman','FontSize',12);
ylabel('tracking error','FontName','Times New Roman','FontSize',12);
f22=legend('$\ell_{p}=0$','$\ell_{p}=1$','$\ell_{p}=8$');
set(f22,'Interpreter','latex','fontsize',10);