clear all;
close all;
%% 总 [e(k) Δx(k) X_R(k)]  35*35  这是例2中预见长度为 3 的程序
I_N = eye(5);
I_m = eye(1);
I_mN = eye(5);

A_R = [ zeros(5,5) eye(5)   zeros(5,10);
        zeros(5,10)  eye(5)  zeros(5,5);
        zeros(5,15)  eye(5);
        zeros(5,20)];
A_R_3 = [ zeros(5,5) eye(5)   zeros(5,10);
        zeros(5,10)  eye(5)  zeros(5,5);
        zeros(5,15)  eye(5);
        zeros(5,20)];


% A1 = [ 0.5712  0.0006;
%        0.0017  0.3679];
% A2 = [  0.2780  0.0004;
%         0.0006  0.3679];
% B = [ 0.7657;
%       0.0011];
t=0.35;
A1 = t* [ 1     1
            -1.55  0.65 ];
A2 = t* [ 1     1
            -2  1.1 ];
B = t*[ 0;
          1 ];  
  
% A1_d = [0.0766  0.000036;
%         0.000109  0.0632 ];  
% A2_d = [0.0564  0.000029;
%         0.00004  0.0632 ];  
     
% C = [ 1  0 ];

A1_d = t* [   0.07  0.02;
             0.09  0.051 ];  
A2_d = t* [    0.05  0.078;
             0.05  0.017 ];  
    
C = [ 0.01  1 ];

% L = [ 1  -1  0  0  0;
%       -1  2  -1  0  0;
%      -1  -1  4   -1   -1;
%       -1 -1  -1   4   -1;
%      -1  -1 -1  0   3];
% M = [ 1 0 0 0 0;
%       0 1 0 0 0;
%       0 0 1 0 0;
%       0 0 0 1 0;
%       0 0 0 0 1 ];

L = [ 2  -1  -1  0  0;
      -1  2  -1  0  0;
     -1 0  3   -1  -1;
      -1 -1  -1   4   -1;
     -1  0 -1  -1   3];
M = [ 1 0 0 0 0;
      0 1 0 0 0;
      0 0 1 0 0;
      0 0 0 1 0;
      0 0 0 0 1 ];
H = L + M;

A_R0_1 = [    I_N  kron(-H,C*A1)  zeros(5)  kron(M,I_m)  zeros(5,10);
            zeros(10,5)  kron(I_N,A1)  zeros(10,20);
            zeros(20,15)  A_R    ];
A_R0_1_d = [ zeros(5)  kron(-H,C*A1_d)  zeros(5,20);
             zeros(10,5)  kron(I_N,A1_d)  zeros(10,20);
             zeros(20,35)];

A_R0_2 = [    I_N  kron(-H,C*A2)  zeros(5)  kron(M,I_m)  zeros(5,10);
            zeros(10,5)  kron(I_N,A2)  zeros(10,20);
            zeros(20,15)  A_R    ];
A_R0_2_d = [ zeros(5)  kron(-H,C*A2_d)  zeros(5,20);
             zeros(10,5)  kron(I_N,A2_d)  zeros(10,20);
             zeros(20,35)];

B_R0 = [    kron(-H,C*B);
            kron(I_N,B);
            zeros(20,5) ];
G_hat = eye(35) - B_R0*inv(B_R0'*B_R0)*B_R0';

F = [ kron(-H,C);
      eye(10);
      zeros(20,10)];
D = [ eye(5)  zeros(5,30) ];
G1 = [ zeros(10,5) eye(10) zeros(10,20)];

% %%
% setlmis([]);
% 
% %%
% % 
% gama = lmivar(2,[1,1]);
% % 表示矩阵
% P0 = lmivar(1,[35,1]); % P
% Q0 = lmivar(1,[35,1]); % Q
% R0 = lmivar(1,[35,1]);  % R
% Y01 = lmivar(2,[5,35]); % Y1
% Y02 = lmivar(2,[5,35]); % Y2
% 
% 
% %% 第一个大矩阵 < 0
% % (1,1)
% lmiterm([1 1 1 Q0],1,1);
% % lmiterm([1 1 1 R0'],-(A_R0_1-eye(35)),1);
% lmiterm([1 1 1 Y01],-B_R0,1,'s');
% lmiterm([1 1 1 R0],-1,(A_R0_1-eye(35))','s');
% % lmiterm([1 1 1 Y01'],-1,B_R0');
% 
% % (1,2)
% lmiterm([1 1 2 P0],1,1);
% lmiterm([1 1 2 R0'],1,1);
% lmiterm([1 1 2 -R0],1,(A_R0_1-eye(35))');
% lmiterm([1 1 2 -Y01'],1,B_R0');
% 
% % (1,3)
% lmiterm([1 1 3 R0'],-G_hat*A_R0_1_d,1);
% 
% % (1,4)
% lmiterm([1 1 4 0],-G_hat*F);
% 
% % (1,5)
% lmiterm([1 1 5 R0],1,D');
% 
% % (2,2)
% lmiterm([1 2 2 P0],1,1);
% lmiterm([1 2 2 R0],1,1,'s');
% % lmiterm([1 2 2 R0'],1,1);
% 
% % (2,3)
% lmiterm([1 2 3 R0'],-G_hat*A_R0_1_d,1);
% 
% % (2,4)
% lmiterm([1 2 4 0],-G_hat*F);
% 
% % (2,5)
% lmiterm([1 2 5 0],0);
% 
% % (3,3)
% lmiterm([1 3 3 Q0],-1,1);
% 
% % (3,4)
% lmiterm([1 3 4 0],0);
% 
% % (3,5)
% lmiterm([1 3 5 0],0);
% 
% % (4,4)
% lmiterm([1 4 4 gama^2],-1,eye(10));
% 
% % (4,5)
% lmiterm([1 4 5 0],0);
% 
% % (5,5)
% lmiterm([1 5 5 0],-eye(5));
% 
% %% 第二个大矩阵 < 0
% % (1,1)
% lmiterm([2 1 1 Q0],1,1);
% % lmiterm([1 1 1 R0'],-(A_R0_1-eye(35)),1);
% lmiterm([2 1 1 Y02],-B_R0,1,'s');
% lmiterm([2 1 1 R0],-1,(A_R0_2-eye(35))','s');
% % lmiterm([1 1 1 Y01'],-1,B_R0');
% 
% % (1,2)
% lmiterm([2 1 2 P0],1,1);
% lmiterm([2 1 2 R0'],1,1);
% lmiterm([2 1 2 -R0],1,(A_R0_2-eye(35))');
% lmiterm([2 1 2 -Y02'],1,B_R0');
% 
% % (1,3)
% lmiterm([2 1 3 R0'],-G_hat*A_R0_2_d,1);
% 
% % (1,4)
% lmiterm([2 1 4 0],-G_hat*F);
% 
% % (1,5)
% lmiterm([2 1 5 R0],1,D');
% 
% % (2,2)
% lmiterm([2 2 2 P0],1,1);
% lmiterm([2 2 2 R0],1,1,'s');
% % lmiterm([1 2 2 R0'],1,1);
% 
% % (2,3)
% lmiterm([2 2 3 R0'],-G_hat*A_R0_2_d,1);
% 
% % (2,4)
% lmiterm([2 2 4 0],-G_hat*F);
% 
% % (2,5)
% lmiterm([2 2 5 0],0);
% 
% % (3,3)
% lmiterm([2 3 3 Q0],-1,1);
% 
% % (3,4)
% lmiterm([2 3 4 0],0);
% 
% % (3,5)
% lmiterm([2 3 5 0],0);
% 
% % (4,4)
% lmiterm([2 4 4 gama^2],-1,eye(10));
% 
% % (4,5)
% lmiterm([2 4 5 0],0);
% 
% % (5,5)
% lmiterm([2 5 5 0],-eye(5));
% 
% %% 第三个大矩阵 < 0
% % (1,1)
% lmiterm([3 1 1 Q0],2,1);
% lmiterm([3 1 1 R0'],-(3/2)*(A_R0_1-eye(35)),1,'s');
% lmiterm([3 1 1 Y02],-(1/2)*B_R0,1,'s');
% lmiterm([3 1 1 R0'],-(1/2)*(A_R0_2-eye(35)),1,'s');
% lmiterm([3 1 1 Y01],-(3/2)*B_R0,1,'s');
% 
% % (1,2)
% lmiterm([3 1 2 P0],2,1);
% lmiterm([3 1 2 R0'],2,1);
% lmiterm([3 1 2 -R0],3/2,(A_R0_1-eye(35))');
% lmiterm([3 1 2 -Y02'],1/2,B_R0');
% lmiterm([3 1 2 -R0],1/2,(A_R0_2-eye(35))');
% lmiterm([3 1 2 -Y01'],3/2,B_R0');
% 
% % (1,3)
% lmiterm([3 1 3 R0'],-(3/2)*G_hat*A_R0_1_d,1);
% lmiterm([3 1 3 R0'],-(1/2)*G_hat*A_R0_2_d,1);
% 
% % (1,4)
% lmiterm([3 1 4 0],-2*G_hat*F);
% 
% % (1,5)
% lmiterm([3 1 5 R0],2,D');
% 
% % (2,2)
% lmiterm([3 2 2 P0],2,1);
% lmiterm([3 2 2 R0],2,1,'s');
% 
% % (2,3)
% lmiterm([3 2 3 R0'],-(3/2)*G_hat*A_R0_1_d,1);
% lmiterm([3 2 3 R0'],-(1/2)*G_hat*A_R0_2_d,1);
% 
% % (2,4)
% lmiterm([3 2 4 0],-2*G_hat*F);
% 
% % (2,5)
% lmiterm([3 2 5 0],0);
% 
% % (3,3)
% lmiterm([3 3 3 Q0],-2,1);
% 
% % (3,4)
% lmiterm([3 3 4 0],0);
% 
% % (3,5)
% lmiterm([3 3 5 0],0);
% 
% % (4,4)
% lmiterm([3 4 4 gama^2],-2,eye(10));
% 
% % (4,5)
% lmiterm([3 4 5 0],0);
% 
% % (5,5)
% lmiterm([3 5 5 0],-2*eye(5));
% 
% %% 第四个大矩阵 < 0
% % (1,1)
% lmiterm([4 1 1 Q0],2,1);
% lmiterm([4 1 1 R0'],-(1/2)*(A_R0_1-eye(35)),1,'s');
% lmiterm([4 1 1 Y02],-(3/2)*B_R0,1,'s');
% lmiterm([4 1 1 R0'],-(3/2)*(A_R0_2-eye(35)),1,'s');
% lmiterm([4 1 1 Y01],-(1/2)*B_R0,1,'s');
% 
% % (1,2)
% lmiterm([4 1 2 P0],2,1);
% lmiterm([4 1 2 R0'],2,1);
% lmiterm([4 1 2 -R0],1/2,(A_R0_1-eye(35))');
% lmiterm([4 1 2 -Y02'],3/2,B_R0');
% lmiterm([4 1 2 -R0],3/2,(A_R0_2-eye(35))');
% lmiterm([4 1 2 -Y01'],1/2,B_R0');
% 
% % (1,3)
% lmiterm([4 1 3 R0'],-(1/2)*G_hat*A_R0_1_d,1);
% lmiterm([4 1 3 R0'],-(3/2)*G_hat*A_R0_2_d,1);
% 
% % (1,4)
% lmiterm([4 1 4 0],-2*G_hat*F);
% 
% % (1,5)
% lmiterm([4 1 5 R0],2,D');
% 
% % (2,2)
% lmiterm([4 2 2 P0],2,1);
% lmiterm([4 2 2 R0],2,1,'s');
% 
% % (2,3)
% lmiterm([4 2 3 R0'],-(1/2)*G_hat*A_R0_1_d,1);
% lmiterm([4 2 3 R0'],-(3/2)*G_hat*A_R0_2_d,1);
% 
% % (2,4)
% lmiterm([4 2 4 0],-2*G_hat*F);
% 
% % (2,5)
% lmiterm([4 2 5 0],0);
% 
% % (3,3)
% lmiterm([4 3 3 Q0],-2,1);
% 
% % (3,4)
% lmiterm([4 3 4 0],0);
% 
% % (3,5)
% lmiterm([4 3 5 0],0);
% 
% % (4,4)
% lmiterm([4 4 4 gama^2],-2,eye(10));
% 
% % (4,5)
% lmiterm([4 4 5 0],0);
% 
% % (5,5)
% lmiterm([4 5 5 0],-2*eye(5));
% 
% 
% %% 约束条件
% lmiterm([-5 1 1 P0],1,1);
% lmiterm([5 1 1 0],0);
% 
% lmiterm([-6 1 1 gama],1,1);
% lmiterm([6 1 1 0],0);
% 
% lmiterm([-7 1 1 Q0],1,1);
% lmiterm([7 1 1 0],0);
% 
% %%
% lmisys=getlmis;
% options=[0,0,0,0,0];
% [tmin,xfeas]=feasp(lmisys,options); 
% 
% %%
% gama = dec2mat(lmisys,xfeas,gama);
% P0 = dec2mat(lmisys,xfeas,P0);
% Q0 = dec2mat(lmisys,xfeas,Q0);
% R0 = dec2mat(lmisys,xfeas,R0);
% Y01 = dec2mat(lmisys,xfeas,Y01);
% Y02 = dec2mat(lmisys,xfeas,Y02);
% 
% K1_35 = Y01 * inv(R0')
% K2_35 = Y02 * inv(R0')

K1_35 = [2.43119006012141,0.783161599237093,0.837211713393114,0.165647342108015,0.200241088229077,1.53089173070407,-0.596459082125735,-0.00480799842832776,0.0320358426044180,-0.00423695019154038,0.0282371010595233,-0.00381119573899357,0.0253525148217340,-0.00352132264865776,0.0233787964425680,-0.0218303934434909,-0.0134773970570803,-0.0150680895305671,-0.00649011069338327,-0.00765542089162812,1.33549212188799,0.466256612788553,0.503255972111372,0.119936783845331,0.144269819319186,0.132890274351841,0.0858461053013888,0.0974579225867730,0.0435461740962769,0.0517644983874152,0.00697678131225141,0.00491469711364745,0.00575373881283018,0.00273679727960589,0.00329813094764117;1.07139470728815,2.19300203846295,0.867876186235857,0.179497127073833,0.221161374609820,-0.00480799842830916,0.0320358426043982,1.53066416290263,-0.594880726542767,-0.00319922859180952,0.0212134989239892,-0.00356103357660088,0.0238374102019032,-0.00238487449528581,0.0157172798590281,-0.0177695443187893,-0.0155364486047308,-0.0134600124314911,-0.00579309845347964,-0.00640738643230637,0.634746799288341,1.17839514300756,0.510298723390907,0.123107828634871,0.149097770199261,0.113690293186350,0.0887144982149087,0.0873844805059247,0.0390037255252563,0.0448663078569335,0.00657275036563730,0.00397316309777738,0.00520569332904723,0.00247383972527824,0.00303504219572798;1.07688830425084,0.450377001756161,1.98374291124725,0.467793203508952,0.560145032363134,-0.00423695019151466,0.0282371010595003,-0.00319922859180152,0.0212134989239895,1.53265276365287,-0.608578769004643,-0.00416819329958902,0.0280129536572492,-0.00441579023875297,0.0296101103918052,-0.0174731110146058,-0.0108906140682345,-0.0154995894786283,-0.00686515927343312,-0.00834493418683310,0.636006563799755,0.287632983180830,1.07730034620762,0.271045033309209,0.324972778097165,0.111885576635970,0.0725287891180159,0.0935775891255064,0.0424376934777839,0.0513280199764118,0.00648436388770238,0.00451382234620272,0.00482785714863588,0.00228912521913937,0.00273373835095264;1.10757864693122,0.761210658130172,0.886921750548242,1.36760525293595,0.516214370261395,-0.00381119573896691,0.0253525148217105,-0.00356103357658709,0.0238374102018995,-0.00416819329959015,0.0280129536572441,1.53409639278303,-0.618499450595868,-0.00394273983647624,0.0265267126533295,-0.0159504178439132,-0.0107001976757103,-0.0129111802065272,-0.00705208177958792,-0.00746075082517641,0.643044710190575,0.440760312634680,0.514594551041493,0.723093578129248,0.298527560970106,0.101817263587182,0.0685446371668640,0.0812086926256997,0.0410488086500249,0.0461412028118246,0.00586905512295628,0.00398373124670100,0.00454562689007542,0.00195367551552392,0.00249201507900256;1.10876846725443,0.474461815590166,0.885202517259755,0.477344794386551,1.69119097711164,-0.00352132264861143,0.0233787964425505,-0.00238487449525894,0.0157172798590279,-0.00441579023873102,0.0296101103918039,-0.00394273983644397,0.0265267126533299,1.53273280438369,-0.608987570950250,-0.0158669660894392,-0.00957250325487169,-0.0130838738020938,-0.00647410883090977,-0.00940692903787803,0.643320576384868,0.293175155446376,0.514188303418252,0.273220361182961,0.895491387786866,0.101423070475970,0.0646064841983076,0.0817870364679197,0.0393193567224372,0.0525024371726922,0.00586395315478886,0.00412137699878627,0.00451435919141146,0.00203954211297629,0.00221459346305860];


K2_35 = [2.43119512958011,0.783165043265888,0.837215703561647,0.165649196502987,0.200243313289283,1.98098918031833,-1.04648762681666,-0.00472438601498053,0.0320113259021985,-0.00415575302568077,0.0282132817539674,-0.00373752620807350,0.0253309039995869,-0.00344841378296821,0.0233574035491877,-0.0218367092762086,-0.0134816341916936,-0.0150729610911202,-0.00649234939859748,-0.00765809784620961,1.33550192089472,0.466263197498671,0.503263552071006,0.119940272909224,0.144273993737954,0.132890699981190,0.0858463935279364,0.0974582563575470,0.0435463289247427,0.0517646841240080,0.00697667335381345,0.00491462529464190,0.00575365667677454,0.00273675982940158,0.00329808627623069;1.07139929924249,2.19300511906367,0.867879788120782,0.179498800730919,0.221163386097554,-0.00472438601501054,0.0320113259022014,1.98074731223416,-1.04490505364149,-0.00312729962705597,0.0211923871989200,-0.00349449511832501,0.0238178909573669,-0.00232085901437519,0.0156984812317208,-0.0177751772562656,-0.0155404155850762,-0.0134643949417892,-0.00579510983655968,-0.00640976750509647,0.634755557404084,1.17840126770522,0.510305546462157,0.123110966040286,0.149101493312491,0.113690677458720,0.0887147579049051,0.0873847818208580,0.0390038653148456,0.0448664756576914,0.00657265508049219,0.00397309381057872,0.00520561961667072,0.00247380618627642,0.00303500292724785;1.07689283226289,0.450380074849521,1.98374644497773,0.467794844937197,0.560147000415955,-0.00415575302571238,0.0282132817539694,-0.00312729962705399,0.0211923871989214,1.98272999279704,-1.05860139081202,-0.00410118819659126,0.0279933090348003,-0.00434820408498381,0.0295903016738794,-0.0174786589564546,-0.0108943234538700,-0.0155040047641618,-0.00686720182097321,-0.00834739317856417,0.636015191620172,0.287638765093430,1.07730719367650,0.271048202273582,0.324976590573540,0.111885955592059,0.0725290458759888,0.0935778859641315,0.0424378310886109,0.0513281849751150,0.00648427011682411,0.00451376030250635,0.00482778153536000,0.00228909032862047,0.00273369623099810;1.10758275446855,0.761213439706814,0.886924966300523,1.36760673521560,0.516216156518749,-0.00373752620806537,0.0253309039995777,-0.00349449511829486,0.0238178909573561,-0.00410118819655190,0.0279933090347844,1.98415943245760,-1.06851792078814,-0.00388171283579660,0.0265088234653533,-0.0159554541682311,-0.0107035986957396,-0.0129151479558759,-0.00705395518307655,-0.00746297261433898,0.643052541640730,0.440765603745240,0.514600714988725,0.723096479168240,0.298531008282826,0.101817607417024,0.0685448700125242,0.0812089620059428,0.0410489335248218,0.0461413525655842,0.00586896995993702,0.00398367384767262,0.00454555950450325,0.00195364319563540,0.00249197713802516;1.10877256741647,0.474464600602414,0.885205725664466,0.477346278852232,1.69119274403783,-0.00344841378297934,0.0233574035491879,-0.00232085901435807,0.0156984812317161,-0.00434820408496343,0.0295903016738739,-0.00388171283581981,0.0265088234653618,1.98279829232071,-1.05900673812861,-0.0158719888139656,-0.00957584195795468,-0.0130878480979664,-0.00647597181786986,-0.00940922367299112,0.643328387870867,0.293180365490832,0.514194473571188,0.273223247854087,0.895494926724856,0.101423413682371,0.0646067168225993,0.0817873052726870,0.0393194812903831,0.0525025864477354,0.00586386827525524,0.00412132142983367,0.00451429151246230,0.00203951010819650,0.00221455317652699];

%% [e(k) Δx(k) X_R(k) ] 35*35
A_R0_1_3 = [    I_N  kron(-H,C*A1)  zeros(5)  kron(M,I_m)  zeros(5,10);
            zeros(10,5)  kron(I_N,A1)  zeros(10,20);
            zeros(20,15)  A_R    ];
A_R0_1_d_3 = [ zeros(5)  kron(-H,C*A1_d)  zeros(5,20);
             zeros(10,5)  kron(I_N,A1_d)  zeros(10,20);
             zeros(20,35)];

A_R0_2_3 = [    I_N  kron(-H,C*A2)  zeros(5)  kron(M,I_m)  zeros(5,10);
            zeros(10,5)  kron(I_N,A2)  zeros(10,20);
            zeros(20,15)  A_R    ];
A_R0_2_d_3 = [ zeros(5)  kron(-H,C*A2_d)  zeros(5,20);
             zeros(10,5)  kron(I_N,A2_d)  zeros(10,20);
             zeros(20,35)];

B_R0_3 = [    kron(-H,C*B);
            kron(I_N,B);
            zeros(20,5) ];
G_hat_3 = eye(35) - B_R0*inv(B_R0'*B_R0)*B_R0';

F_3 = [ kron(-H,C);
      eye(10);
      zeros(20,10)];
D_3 = [ eye(5)  zeros(5,30) ];


Y = zeros(10,1);
  
X= [ kron(-H,C)*Y;
     Y;
     zeros(20,1) ]; % [e x1 x2 x3 r r1 d d1]
 
%%  R(k)
for k=1:1:1000
    if k<15
        R(:,k) =zeros(5,1);
    elseif k>=15 & k<=30
        R(:,k) = ( (k-15)/10 )*100*ones(5,1);
    else
        R(:,k) = 1.5*100*ones(5,1);
    end
end

%% 滑模面、控制律、输出
for k=1:1:121
    time(k)=(k-1)/20;
%%
      %预见长度(1,1)
      Y1(:,k)=[Y(1,k) Y(3,k) Y(5,k) Y(7,k) Y(9,k)];
      Y2(:,k)=[Y(2,k) Y(4,k) Y(6,k) Y(8,k) Y(10,k)];
      
      Tr1(:,k)=kron(I_N,C)*Y(:,k);
      
      if k>1
          % 误差 e
          x11(:,k)= -kron(H,I_m) * (kron(I_N,C)*Y(:,k) - R(:,k));
          % Δx 
          x21(:,k)=Y1(:,k)-Y1(:,k-1);
          x31(:,k)=Y2(:,k)-Y2(:,k-1);
      else
          x11(:,k)= -kron(H,I_m) * (kron(I_N,C)*Y(:,k) - R(:,k));
          
          x21(:,k)=Y1(:,k);
          x31(:,k)=Y2(:,k);
      end
      
      % ΔR(k)
      if k==1
          x51(:,k)=R(:,k);
          x61(:,k)=R(:,k+1)-R(:,k);
          x71(:,k)=R(:,k+2)-R(:,k+1);
          x81(:,k)=R(:,k+3)-R(:,k+2);
      else
          x51(:,k)=R(:,k)-R(:,k-1);
          x61(:,k)=R(:,k+1)-R(:,k);
          x71(:,k)=R(:,k+2)-R(:,k+1);
          x81(:,k)=R(:,k+3)-R(:,k+2);
      end
      
      %h1(:,k) =  ( 0.02*(   sin( (Y(2,k)+Y(4,k)+Y(6,k)+Y(8,k)+Y(10,k))/5  )   )^2  ) / (exp(2)+exp(5));
      h1(:,k) =  ( 20*(   sin( (Y(2,k)+Y(4,k)+Y(6,k)+Y(8,k)+Y(10,k))/5  )   )^2  ) / (exp(2)+exp(5));
      h2(:,k) = 1-h1(:,k);
      
      if k>1
         
          S3(:,k) = B_R0_3'*[x11(:,k);x21(:,k);x31(:,k);x51(:,k);x61(:,k);x71(:,k);x81(:,k)] - B_R0_3'* ...
                  (   h1(:,k-1)*h1(:,k-1)*(A_R0_1_3 + B_R0_3*K1_35)* [x11(:,k-1);x21(:,k-1);x31(:,k-1);x51(:,k-1);x61(:,k-1);x71(:,k-1);x81(:,k-1)] + ...
                      h1(:,k-1)*h2(:,k-1)*( A_R0_1_3 + B_R0_3*K2_35 )*[x11(:,k-1);x21(:,k-1);x31(:,k-1);x51(:,k-1);x61(:,k-1);x71(:,k-1);x81(:,k-1)] + ...
                      h2(:,k-1)*h1(:,k-1)*( A_R0_2_3 + B_R0_3*K1_35 )*[x11(:,k-1);x21(:,k-1);x31(:,k-1);x51(:,k-1);x61(:,k-1);x71(:,k-1);x81(:,k-1)] + ...
                      h2(:,k-1)*h2(:,k-1)*( A_R0_2_3 + B_R0_3*K2_35 )*[x11(:,k-1);x21(:,k-1);x31(:,k-1);x51(:,k-1);x61(:,k-1);x71(:,k-1);x81(:,k-1)]...
                  );
      else
          S3(:,k) = B_R0_3'*[x11(:,k);x21(:,k);x31(:,k);x51(:,k);x61(:,k);x71(:,k);x81(:,k)];
      end
      
      e1=0;
      e2=0;
      
      % Δu(k) 的线性项
      for j=1:1:k
          e1=e1+x11(:,j);
      end

      % Δu(k) 的非线性项
      for j=1:1:k
          for jj=1:1:5
              sat(jj,j)=sign( S3(jj,j) );
          end
          
          if j>1
             if j>4
                W(:,j) = ( h1(:,j)-h1(:,j-1)+h2(:,j)-h2(:,j-1) ) * (  kron(I_N,A1)*[Y1(:,j-1);Y2(:,j-1)] + kron(I_N,A1_d)*[Y1(:,j-3-1);Y2(:,j-3-1)] ) + ...
                          t*[ 0;  -0.01*cos(Y(1,j));  0;  -0.01*cos(Y(3,j));  0;  -0.01*cos(Y(5,j));  0;  -0.01*cos(Y(7,j)); 0;  -0.01*cos(Y(9,j)) ]; 
                
                %e2=e2 + inv(B_R0_3'*B_R0_3)* (  (0.45-1)*S3(:,j) + 0.57*sat + norm(inv(B_R0_3'*B_R0_3)*B_R0_3'*F_3) * norm( W(:,j)) ) + 0.008*norm( [x21(:,j) zeros(5,1)] );
                
                gbgf=inv(B_R0_3'*B_R0_3)*B_R0_3'*F_3;
                e2=e2 + inv(B_R0_3'*B_R0_3)* (  (0.345-1)*S3(:,j) + 0.027*sat(:,j) + ...
                   [ norm(gbgf(:,1:5)) ,norm(gbgf(:,6:10)) ]* [ norm( W(1:5,j)); norm( W(5:10,j)) ] )...
                   +  0.008*norm( [x21(:,j) zeros(5,1)] ) ;
             else
                 W(:,j) = ( h1(:,j)-h1(:,j-1)+h2(:,j)-h2(:,j-1) ) * (  kron(I_N,A1)*[Y1(:,j-1);Y2(:,j-1)] ) + ...
                           t*[ 0;  -0.01*cos(Y(1,j));  0;  -0.01*cos(Y(3,j));  0;  -0.01*cos(Y(5,j));  0;  -0.01*cos(Y(7,j)); 0;  -0.01*cos(Y(9,j)) ];
                
                %e2=e2 + inv(B_R0_3'*B_R0_3)* (  (0.45-1)*S3(:,j) + 0.57*sat + norm(inv(B_R0_3'*B_R0_3)*B_R0_3'*F_3) * norm( W(:,j)) ) + 0.008*norm( [x21(:,j) zeros(5,1)] );
                
                gbgf=inv(B_R0_3'*B_R0_3)*B_R0_3'*F_3;
                e2=e2 + inv(B_R0_3'*B_R0_3)* (  (0.345-1)*S3(:,j) + 0.027*sat(:,j) + ...
                   [ norm(gbgf(:,1:5)) ,norm(gbgf(:,6:10)) ]* [ norm( W(1:5,j)); norm( W(5:10,j)) ] )...
                   +  0.008*norm( [x21(:,j) zeros(5,1)] ) ;
             end
             
          else
               W(:,j) = t*[ 0;  -0.01*cos(Y(1,j));  0;  -0.01*cos(Y(3,j));  0;  -0.01*cos(Y(5,j));  0;  -0.01*cos(Y(7,j)); 0;  -0.01*cos(Y(9,j)) ];
               
              %e2=e2 + inv(B_R0_3'*B_R0_3)* (  (0.45-1)*S3(:,j) + 0.57*sat + norm(inv(B_R0_3'*B_R0_3)*B_R0_3'*F_3) * norm( W(:,j)) )+ 0.008*norm( [x21(:,j) zeros(5,1)] );
              
              gbgf=inv(B_R0_3'*B_R0_3)*B_R0_3'*F_3;
                e2=e2 + inv(B_R0_3'*B_R0_3)* (  (0.345-1)*S3(:,j) + 0.027*sat(:,j) + ...
                   [ norm(gbgf(:,1:5)) ,norm(gbgf(:,6:10)) ]* [ norm( W(1:5,j)); norm( W(5:10,j)) ] )...
                   +  0.008*norm( [x21(:,j) zeros(5,1)] ) ;
          end
      end
      
      if k>3
         U3(:,k)=( h1(:,k)*K1_35+h2(:,k)*K2_35 ) * [e1;Y1(:,k);Y2(:,k);R(:,k);R(:,k+1);R(:,k+2);R(:,k+3)] - ...
                 ( h1(:,k)*inv(B_R0_3'*B_R0_3)*B_R0_3'*A_R0_1_d +  h2(:,k)*inv(B_R0_3'*B_R0_3)*B_R0_3'*A_R0_2_d ) *...
                 [ e1;Y1(:,k-3);Y2(:,k-3);R(:,k-3);R(:,k+1-3);R(:,k+2-3);R(:,k+3-3) ] -e2 ;
             
         Y(:,k+1) =  h1(:,k) * (  kron(I_N,A1)*Y(:,k) + kron(I_N,A1_d)*Y(:,k-3) + kron(I_N,B)* ( U3(:,k)+0.004*[abs(Y(1,k)+1) - abs(Y(1,k)-1); abs(Y(3,k)+1) - abs(Y(3,k)-1); abs(Y(5,k)+1) - abs(Y(5,k)-1); abs(Y(7,k)+1) - abs(Y(7,k)-1); abs(Y(9,k)+1) - abs(Y(9,k)-1) ] )  + ...
                        t*[ 0;  -0.01*cos(Y(1,k));  0;  -0.01*cos(Y(3,k));  0;  -0.01*cos(Y(5,k));  0;  -0.01*cos(Y(7,k)); 0;  -0.01*cos(Y(9,k)) ] ) +...
                      h2(:,k) * (  kron(I_N,A2)*Y(:,k) + kron(I_N,A2_d)*Y(:,k-3) + kron(I_N,B)* ( U3(:,k)+0.004*[abs(Y(1,k)+1) - abs(Y(1,k)-1); abs(Y(3,k)+1) - abs(Y(3,k)-1); abs(Y(5,k)+1) - abs(Y(5,k)-1); abs(Y(7,k)+1) - abs(Y(7,k)-1); abs(Y(9,k)+1) - abs(Y(9,k)-1) ] ) + ...
                        t*[ 0;  -0.01*cos(Y(1,k));  0;  -0.01*cos(Y(3,k));  0;  -0.01*cos(Y(5,k));  0;  -0.01*cos(Y(7,k)); 0;  -0.01*cos(Y(9,k)) ] );
      else
          U3(:,k)=( h1(:,k).*K1_35+h2(:,k).*K2_35 ) * [e1;Y1(:,k);Y2(:,k);R(:,k);R(:,k+1);R(:,k+2);R(:,k+3)] - e2;
          
          Y(:,k+1) =  h1(:,k) * (  kron(I_N,A1)*Y(:,k) + kron(I_N,B)* ( U3(:,k)+0.004*[abs(Y(1,k)+1) - abs(Y(1,k)-1); abs(Y(3,k)+1) - abs(Y(3,k)-1); abs(Y(5,k)+1) - abs(Y(5,k)-1); abs(Y(7,k)+1) - abs(Y(7,k)-1); abs(Y(9,k)+1) - abs(Y(9,k)-1) ]  ) + ...
                        t*[ 0;  -0.01*cos(Y(1,k));  0;  -0.01*cos(Y(3,k));  0;  -0.01*cos(Y(5,k));  0;  -0.01*cos(Y(7,k)); 0;  -0.01*cos(Y(9,k)) ] ) + ...
                      h2(:,k) * (  kron(I_N,A2)*Y(:,k) + kron(I_N,B)* ( U3(:,k)+0.004*[abs(Y(1,k)+1) - abs(Y(1,k)-1); abs(Y(3,k)+1) - abs(Y(3,k)-1); abs(Y(5,k)+1) - abs(Y(5,k)-1); abs(Y(7,k)+1) - abs(Y(7,k)-1); abs(Y(9,k)+1) - abs(Y(9,k)-1) ] ) + ...
                        t*[ 0;  -0.01*cos(Y(1,k));  0;  -0.01*cos(Y(3,k));  0;  -0.01*cos(Y(5,k));  0;  -0.01*cos(Y(7,k)); 0;  -0.01*cos(Y(9,k)) ] ) ;
      end
     
end

%% R1(k)
for k=1:1:121
    if k<15
       R1(:,k) =zeros(5,1);
    elseif k>=15 & k<=30
        R1(:,k) = ( (k-15)/10 )*100*ones(5,1);
    else
       R1(:,k) = 1.5*100*ones(5,1);
    end
end

%% 
figure(1);
plot(time,R1(1,:)/100,'k-',time,Tr1(1,:)/100,time,Tr1(2,:)/100,time,Tr1(3,:)/100,time,Tr1(4,:)/100,time,Tr1(5,:)/100,'LineWidth',1);
xlabel('time(s)','FontName','Times New Roman','FontSize',12);
ylabel('output response','FontName','Times New Roman','FontSize',12);
f1=legend('$r_{k}$','agent1','agent2','agent3','agent4','agent5','Location','NorthWest','FontName','Times New Roman');
set(f1,'Interpreter','latex','fontsize',10);

axes('Position',[0.35,0.55,0.55,0.2]); % 生成子图   
plot(time,R1(1,:)/100,'k-',time,Tr1(1,:)/100,time,Tr1(2,:)/100,time,Tr1(3,:)/100,time,Tr1(4,:)/100,time,Tr1(5,:)/100,'LineWidth',1);
ylim([1.11,1.113]); % 放大的横坐标
xlim([1.236,1.257]); % 放大的横坐标

figure(2);
plot(time,S3(1,:)/100,time,S3(2,:)/100,time,S3(3,:)/100,time,S3(4,:)/100,time,S3(5,:)/100,'LineWidth',1);
xlabel('time(s)','FontName','Times New Roman','FontSize',12);
ylabel('sliding mode surface ','FontName','Times New Roman','FontSize',12);
legend('agent1','agent2','agent3','agent4','agent5','FontName','Times New Roman','FontSize',10);

figure(3);
plot(time,U3(1,:)/100,time,U3(2,:)/100,time,U3(3,:)/100,time,U3(4,:)/100,time,U3(5,:)/100,'LineWidth',1);
xlabel('time(s)','FontName','Times New Roman','FontSize',12);
ylabel('control input','FontName','Times New Roman','FontSize',12);
legend('agent1','agent2','agent3','agent4','agent5','FontName','Times New Roman','FontSize',10);

axes('Position',[0.35,0.55,0.55,0.2]); % 生成子图   
plot(time,U3(1,:)/100,time,U3(2,:)/100,time,U3(3,:)/100,time,U3(4,:)/100,time,U3(5,:)/100,'LineWidth',1);
ylim([3.455,3.467]); % 放大的横坐标
xlim([1.261,1.284]); % 放大的横坐标

figure(4);
plot(time,x11(1,:)/100,time,x11(2,:)/100,time,x11(3,:)/100,time,x11(4,:)/100,time,x11(5,:)/100,'LineWidth',1);
xlabel('time(s)','FontName','Times New Roman','FontSize',12);
ylabel('tracking error','FontName','Times New Roman','FontSize',12);
legend('agent1','agent2','agent3','agent4','agent5','FontName','Times New Roman','FontSize',10);

%% 第一个智能体系统在不同预见长度下的跟踪
%   0预见
Tr0 = [0,-0.0563234241622905,-0.0284067814900333,-0.0363202481063481,-0.0430630561091008,-0.0556079496031771,-0.0462491278395533,-0.0733244597958582,-0.0593092474374880,-0.0476982836968908,-0.0458129751496391,-0.0769785883338017,-0.0533379720659496,-0.0484911598583271,-0.0494892695131156,-0.0318444726253146,12.0963947719126,21.8922985539154,31.0344788436051,40.9694867432985,50.6949266769593,60.1975605152586,69.7232917896961,79.6735729208627,90.0249656524958,99.0381445649498,109.444577564479,120.066134371250,130.280624262922,139.088969377916,150.061265363704,146.562973738447,147.516470536771,148.422170929468,149.187862848066,149.027639589623,149.358202406660,150.155272362920,149.200967709823,149.369461471366,150.041359348360,149.664111656574,149.723111074117,149.705955972315,150.010059786466,149.794841077483,149.824846406019,149.868798571829,149.956813458803,149.859576719932,149.899520396005,149.924947647981,149.930831956116,149.894303199464,149.918911572058,149.936393107164,149.923013692063,149.907813445041,149.912449176328,149.937962165842,149.913605179327,149.938754642174,149.932885366308,149.958199748146,149.918846905051,149.956265969187,149.938715886345,149.959920945280,149.967641777553,149.962393488439,149.971502976029,149.937052279915,149.961092383561,149.944690380375,149.964212927896,149.927348180786,149.961532176616,149.956827529477,149.961325288765,149.976982595750,149.965901792475,149.973813452115,149.938810573875,149.962834676261,149.946071425076,149.964424611034,149.971598784603,149.965615770342,149.972552661885,149.938482026625,149.962538478565,149.945119271644,149.964549944250,149.971530016483,149.965250503919,149.972442907739,149.938461387934,149.962548367302,149.944985572267,149.964481201443,149.971588195225,149.965224287446,149.972392231963,149.938455445871,149.962569835096,149.944978041598,149.964455887143,149.971592030154,149.965235759059,149.972385389200,149.938446375573,149.962573857790,149.944983104654,149.964451802431,149.971588274843,149.965238932507,149.972387097113,149.938443841370,149.962572696346,149.944984921502,149.964452319043];

%   3预见
Tr1 = [0,-0.0563234241622905,-0.0248485299766928,-0.0358102886963304,-0.0414708917704828,-0.0531171301363109,-0.0293260726318787,-0.0398640524683110,-0.0727355315428869,-0.0590903564956545,-0.0533342739830442,-0.0788758486641628,-0.0658024510468489,0.0293858205172558,1.44357290354461,9.89065882843419,22.1869552671914,32.1960223163580,42.1648924003930,52.1958154308320,62.0014882100300,72.3436095772992,82.2420181396878,92.0966674886004,101.744484809421,111.449812617542,121.658295590472,131.988538476206,142.623580004289,149.829385219407,151.895270225691,150.468004334780,148.455796225089,150.495081164970,148.517552865522,150.408625012962,149.145270741426,150.409790515742,149.237558017769,150.109737019555,149.527044563574,150.164930010195,149.616028225772,149.974812798003,149.767578516310,149.974515461766,149.779497671811,149.984683111054,149.828992953012,149.912464011998,149.868619299720,149.964444745552,149.873483301457,149.930386289568,149.916215721794,149.948804144219,149.901498697008,149.936256317709,149.932460708300,149.927561470854,149.941103761468,149.937727296720,149.960302503681,149.951406461541,149.961666488087,149.948805817144,149.938332767245,149.938768805295,149.956448556904,149.958660691831,149.931787394747,149.964351119271,149.969886991055,149.980788670099,149.970315921554,149.973968378009,149.970083559128,149.940147959654,149.970397441286,149.944993198863,149.953268790206,149.959760823949,149.965458205710,149.962768387664,149.948283181256,149.955163564005,149.932848696334,149.973515925983,149.941571500320,149.986186995615,149.956275642241,149.973179820765,149.967764220038,149.940800510654,149.965740072995,149.958523497279,149.953636451841,149.950136089698,149.961928114942,149.964911045336,149.962660807826,149.949146084121,149.969340609884,149.932557879181,149.980563259826,149.942403171054,149.988291891731,149.957368589530,149.956207246981,149.969271925924,149.934141833913,149.981421858969,149.942637094564,149.989330778412,149.957055127075,149.974627057023,149.968733864026,149.940928607171,149.966423149599,149.958771000661,149.953838692823];

%   2预见 Tr2是cc2_5中的Tr1  不考虑
Tr2 = [0,-0.0478216222918276,-0.0532836475833280,-0.0534534856017825,-0.0555377160790393,-0.0553559925953150,-0.0556344405688371,-0.0569500987112338,-0.0580582964437390,-0.0547567299351336,-0.0582305357436294,-0.0568357140076291,-0.0573082023501458,-0.0565175797086041,1.77226059761983,10.0084260355754,22.1869201641216,31.0484296744775,40.9312541758839,50.6827578312106,60.1377250051455,69.7958298381405,80.1317193609504,89.8520752317210,100.104881745956,110.923823903473,119.712490206359,130.420236062750,139.056475163668,148.300425901090,150.443688441974,147.747203686384,148.816943283219,148.425847434618,148.377470871429,148.248319779165,149.767669854279,148.031734430347,149.846766682436,147.965856901478,148.670921213129,148.883980507245,147.902466705228,149.224980112637,148.131189341799,149.547028277663,147.779550492453,150.190636089170,147.822742842302,150.675775156453,147.974832530408,150.077722143773,149.221100132850,150.122587585202,149.872806260605,149.979707538204,149.858451809284,149.805636480355,149.917749720457,150.011746668698,149.908483686346,149.820292248507,149.978889638812,149.827097115952,149.982903165380,149.954362801316,149.934839649224,149.890644310452,149.997201595943,149.956158163564,149.914481496482,149.945955641032,149.972223625936,149.940504531943,149.934324530464,149.958716742674,149.958295721429,149.934399037104,149.950901964690,149.956955355184,149.947323145178,149.941903845584,149.954715510781,149.952283358917,149.944538365309,149.948452992796,149.953708480777,149.948171904865,149.946800358133,149.950989988656,149.951114880014,149.947287362687,149.949107127004,149.951030594469,149.949198872621,149.948168390491,149.950164379814,149.950082018495,149.948689536798,149.949172964882,149.950168384617];

%   pid控制的跟踪
Tr_pid = [0,-0.00350000000000000,-0.00375724913315932,-0.00238590193092311,-0.000335684840746083,0.000906192517393750,0.00118490497850502,0.000645045513182096,-2.44990434799366e-05,-0.000500147496551068,-0.000535937409070699,-0.000322764847896746,-2.06739425624662e-06,0.000184550819820093,0.000225936681477115,0.000115805069750527,3.14998979266990,8.05699352858765,16.1462564537614,26.4374119855433,37.3059419482979,47.8580503221163,58.0262756365352,67.0254081689721,76.4935031338143,85.9937735523802,95.8298225548701,105.612748425827,115.578700074310,125.646751086472,136.220826573458,144.022205629372,148.065145607713,150.222036609143,149.150368605001,148.726653497938,148.531214264155,148.645300024875,149.117121693570,149.382593664621,149.658006100791,149.855158677640,149.951505551745,149.928621219733,149.898252448404,149.908884317972,149.985944782781,150.055102632560,150.062533073612,149.998501279088,149.927423069697,149.923194146438,149.987050475123,150.067669069094,150.075654986593,150.014692743610,149.929739581834,149.921780208071,149.981953105180,150.072000355229,150.080102246926,150.018855575118,149.925178519537,149.918192344223,149.980655792876,150.077947545750,150.083267592749,150.018237532097,149.918738209102,149.916067603481,149.983439918279,150.084838807503,150.084008493904,150.013570720087,149.911729210151,149.916837819775,149.989954451035,150.091705695605,150.081454500682,150.005538772868,149.905296673400,149.921217891367,149.999375494346,150.097377464715,150.075112267529,149.995110794590,149.900637991853,149.929504904261,150.010600289129,150.100703396800,150.064895224554,149.983495573521,149.898843629337,149.941563159985,150.022322961730,150.100708991318,150.051147093505,149.972066471201,149.900761617265,149.956825916211,150.033132559855,150.096716678354,150.034626195811,149.962248663686,149.906886522027,149.974334259435,150.041636777718,150.088439364010,150.016452311415,149.955385461506,149.917281239296,149.992813697757,150.046596216847,150.076039000179,149.998015930380,149.952599510202,149.931540393578,150.010785102168,150.047054949585,150.060143271074,149.980854198347];

% %   信息融合控制的跟踪
% Tr_xxrh = [0,-0.00696879246202699,-0.0123435948487405,-0.0131044487186859,-6.69707043303824e-05,1.63977492012090e-05,-1.43361396999308e-05,-2.49155536416021e-05,-2.62210208270050e-05,-2.86888553771743e-05,-3.01218914377526e-05,-3.08164502500689e-05,-3.10152311614770e-05,-0.00995809257254992,0.0271170605068279,9.92280349902900,19.8709808223984,29.7875513973877,39.7017895342653,49.6162024414855,59.5311319753799,69.4450658657649,79.3500176290829,89.2428876181219,99.1499570002871,109.077761022781,118.993257605500,128.904911161492,138.826566483909,148.706386280847,148.709732001309,148.629200546288,148.658845154520,148.633258362346,148.604379556531,148.596970592195,148.595672642121,148.595565110926,148.595613726636,148.595661862381,148.595691263749,148.595707731985,148.595716288736,148.595720585591,148.595722711688,148.595723768955,148.595724294362,148.595724554572,148.595724682995,148.595724746416,148.595724777770,148.595724793273,148.595724800933,148.595724804716,148.595724806586,148.595724807510,148.595724807966,148.595724808191,148.595724808303,148.595724808358,148.595724808385,148.595724808399,148.595724808405,148.595724808408,148.595724808410,148.595724808411,148.595724808411,148.595724808411,148.595724808411,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412,148.595724808412];

figure(5);
%plot(time,R1(1,:)/100,'k-',time,Tr0/100,time,Tr2/100,time,Tr1/100,'LineWidth',1);
plot(time,R1(1,:)/100,'k-',time,Tr1/100,time,Tr0/100,time,Tr_pid/100,'LineWidth',1);
xlabel('time(s)','FontName','Times New Roman','FontSize',12);
ylabel('output response','FontName','Times New Roman','FontSize',12);
f11=legend('$r_{k}$','$SMPC$','$SMC$','$PID$');
set(f11,'Interpreter','latex','fontsize',10);

axes('Position',[0.38,0.5,0.5,0.2]); % 生成子图   
plot(time,R1(1,:)/100,'k-',time,Tr1/100,time,Tr0/100,time,Tr_pid/100,'LineWidth',1);
xlim([1.17,1.32]); % 放大的横坐标
ylim([0.975,0.98]); % 放大的横坐标

%% 第一个智能体系统在不同预见长度下的误差
%   0预见
x11_0 = [0,0.0661398771348409,0.0531852073061896,0.0269364242360889,0.0473824770914919,0.0644639663132632,0.0556865148173732,0.0908244668136523,0.0745247899231358,0.0479187131614978,0.0533772295118122,0.101335385937865,0.0667087092923553,0.0551522827205756,0.0513549397690956,10.0349803566984,7.93441472751853,3.74084718487028,6.04837388729737,6.34009361462233,6.19432061089057,6.74277455760428,7.60683189596389,7.68791666850463,7.29171984006811,8.62863867118392,8.12780441687950,6.73121297262627,6.26525968951165,8.70128521877322,-2.92389022966992,1.44591929888651,4.60943801102056,1.53114060093134,0.271242689887345,1.09593909772622,1.22921504574543,-0.515592933235894,1.35124147638268,0.915772764851738,-0.0195437838568751,0.527743187568461,0.406957531912497,0.404855572619823,-0.00175199844971985,0.276533497652281,0.245469615315301,0.140358097378765,0.0633142906691546,0.163622755808632,0.129244589361861,0.0755484909718689,0.100605308849765,0.130727780007391,0.0975616777961932,0.0706893246298819,0.102503629673606,0.119632419602141,0.0998663299912437,0.0712908314391711,0.108017341585736,0.0695184056131382,0.0752998367138673,0.0456545081325146,0.101292734930695,0.0546187106735658,0.0689653701904831,0.0437266102837839,0.0333219954686967,0.0436459972333125,0.0326478088805402,0.0852397592036311,0.0402101500151275,0.0640592522395309,0.0362884453031427,0.0928855191874902,0.0476762307535807,0.0490653607149625,0.0414925956860941,0.0239087305621979,0.0385568295984911,0.0298246797049728,0.0827636384078687,0.0388719377241387,0.0615568896589593,0.0367318615536192,0.0300710707131486,0.0367389693078621,0.0335490413740160,0.0813029083807919,0.0396989998198762,0.0626200927127627,0.0361448144254553,0.0305580829235907,0.0368168459058609,0.0337622808278013,0.0813663898135246,0.0396048848287478,0.0628302102684017,0.0361916097528763,0.0305039622841719,0.0368629035716879,0.0337952968890818,0.0813895784120859,0.0395805396996138,0.0628382975891384,0.0362223279585692,0.0304987305376585,0.0368551576140135,0.0338014303004286,0.0813991066032145,0.0395784504960659,0.0628328872438431,0.0362266818543731,0.0305030540716018,0.0368522767815023,0.0337999441188970,0.0814016462739460,0.0395799200324518,0.0628311935040244,0.0362260465956297];

%   3预见 
x11_2 = [0,0.0661398771348409,0.0490140804794758,0.0229628614032621,0.0497965626815835,0.0600724469981042,0.0372868168908865,0.0304601329423487,0.0996209161278174,0.0740945569367413,0.0596611984389975,0.0977790139086748,0.0818677063459353,-0.0374421242762556,-1.75838681755959,-0.332249367020832,-4.71341857348968,-5.29510747518140,-4.01258696696773,-4.37152573345870,-4.27580230796371,-4.98174628394023,-4.71473270319854,-4.09478027207044,-3.61768402514213,-3.07189907330178,-3.38319572144805,-4.16329768792602,-5.54421700911348,-1.04735090194126,-3.02396167502295,-0.984356179907138,3.61916594523910,-1.06075599571776,2.35616974309977,-0.315981207359073,1.16757273873381,-0.333149447616222,0.872502781618834,0.209122015028328,0.495298393545994,-0.0836117924329756,0.260634928973246,0.371601880088576,0.0938657704270440,0.192354382674807,0.0942673834002505,0.226228188233677,0.0811375979718036,0.232193952063597,0.0559174398730420,0.144803147743005,0.0799876310010461,0.148288743527161,0.0341863896915413,0.109375220431161,0.0791379705084125,0.107437171266440,0.0457405443461596,0.121777289055530,0.0439886554312636,0.0907064035930034,0.0306814293164450,0.0613385090946395,0.0350313019900455,0.0644981617246856,0.0769030920425848,0.0648876616521932,0.0479205946627133,0.0471861966302072,0.0903951554162461,0.0415830443625964,0.0367679865121886,0.0212389332780845,0.0369857853524138,0.0292333176639374,0.0276249595459888,0.0803505358741177,0.0351553669414670,0.0581329037612761,0.0732961965331072,0.0425436991620245,0.0467689495977197,0.0352020801185518,0.0538832147940411,0.0486634843722698,0.0872652768013893,0.0321004968262457,0.0651593225622094,0.0216674295341761,0.0385462291987722,0.0367458117159742,0.0315359685222916,0.0827337569018596,0.0324412229273037,0.0512582467508764,0.0441510026967649,0.0798368211335969,0.0361854447557164,0.0495860535310442,0.0348398583681160,0.0520834555334773,0.0350752700648513,0.0850835385147093,0.0274939560012228,0.0617728251256438,0.0203664995459008,0.0366150262642861,0.0501082204305021,0.0301469247525290,0.0875615482147794,0.0221893925521499,0.0660734696596705,0.0146005849649384,0.0411225205735093,0.0320773979094327,0.0324042004475018,0.0814734194496509,0.0319947323574468,0.0509915615903083,0.0437403958692642];

%  pid控制的误差
x11_pid = [0,0.00350000000000000,0.00351347413315932,0.00232278038676380,0.000255594066608204,-0.000786298631850996,-0.00116055747754018,-0.000593199400801249,-5.70684714081945e-05,0.000479637948002570,0.000500218324865268,0.000380804384603001,2.09307306826092e-05,-0.000163718043623031,-0.000275565659647002,9.99985766984718,16.1534933088555,21.3379041513838,22.9245474972037,22.9420287925914,21.9423249546992,21.5271415179540,21.1220054688639,22.2005602701636,22.5913996812399,23.2940040162543,23.3936818403378,23.6924733841836,23.5489393527871,23.4961775158976,12.8600545638103,5.91724012795157,1.83855080674203,-0.0322349012069481,0.701678128506927,1.09451523242876,1.24690802123044,1.37159874396968,0.987761098131813,0.768867735432053,0.293983656362627,-0.00642419874031930,-0.132440877876803,0.0660441051156795,0.242227256897507,0.271789603333474,0.0446530891294970,-0.200246712097709,-0.255225792424028,-0.0544953264012804,0.221384502692416,0.281848875790104,0.0882880141690237,-0.223737447308281,-0.295146705088229,-0.105215231367765,0.235911563968926,0.312407128862446,0.119053365869036,-0.249918974865636,-0.328648495048867,-0.125750229466803,0.267298928884145,0.343540747497883,0.127564370059275,-0.286989840676341,-0.356346658832479,-0.123281655274411,0.308356076586279,0.365883930554872,0.114111648317902,-0.330959277059719,-0.371813591444976,-0.0995210824724495,0.353757336225954,0.373333941879054,0.0806260524509526,-0.376273653752719,-0.370133671485434,-0.0573679395366469,0.397388275870384,0.361831733946872,0.0308225457781930,-0.416563143178735,-0.348228223977259,-0.00135199895709093,0.432779758917548,0.329312802565738,-0.0299983327680877,-0.445485368201133,-0.305108820889785,0.0625414881415622,0.453879456330441,0.275912144572203,-0.0952576000183854,-0.457476973386690,-0.242038423385310,0.127270083814210,0.455759865037464,0.204035411293859,-0.157597777671242,-0.448414620785599,-0.162513769017608,0.185315760705009,0.435226979756550,0.118236718936060,-0.209529136038412,-0.416153017613397,-0.0720436693484885,0.229381216505885,0.391278758158251,0.0248875994272453,-0.244152079130231,-0.360889665724500,0.0222805684015270,0.253127081468080,0.325364416672443,-0.0683524006568064,-0.255880898805003,-0.285313271388077,0.112400814036249];

% %  信息融合控制的误差
% x11_xxrh = [0,0.00696211818177748,0.0123232009850582,0.0130740149757135,8.12788561560336e-05,-1.98887113225612e-05,1.74012666026683e-05,3.02461043483333e-05,3.18314844501124e-05,3.48258838811007e-05,3.65652163488244e-05,3.74081317015121e-05,3.76493099900681e-05,0.0120853531159459,-0.0329076969279737,0.0937071382775763,0.156624895245791,0.257896679581346,0.362003741615503,0.465898420528909,0.569165671090651,0.673641407670090,0.789018207083075,0.919058389342823,1.03186645245111,1.11950925779983,1.22208669132583,1.32932999716405,1.42443530225705,1.57031106072606,1.56625668940578,1.66399161784207,1.62802229443503,1.65906889380307,1.69411912536455,1.70311264111862,1.70468677458936,1.70481654673776,1.70475720195239,1.70469858555069,1.70466278476948,1.70464274191002,1.70463233385192,1.70462710867989,1.70462452324688,1.70462323759514,1.70462259878624,1.70462228246444,1.70462212636528,1.70462204928154,1.70462201117749,1.70462199233882,1.70462198303250,1.70462197843548,1.70462197616470,1.70462197504250,1.70462197448828,1.70462197421472,1.70462197407903,1.70462197401258,1.70462197397930,1.70462197396276,1.70462197395477,1.70462197395105,1.70462197394872,1.70462197394789,1.70462197394730,1.70462197394716,1.70462197394733,1.70462197394707,1.70462197394701,1.70462197394704,1.70462197394698,1.70462197394693,1.70462197394710,1.70462197394673,1.70462197394707,1.70462197394693,1.70462197394710,1.70462197394684,1.70462197394693,1.70462197394698,1.70462197394701,1.70462197394696,1.70462197394701,1.70462197394698,1.70462197394704,1.70462197394687,1.70462197394707,1.70462197394701,1.70462197394681,1.70462197394713,1.70462197394701,1.70462197394698,1.70462197394701,1.70462197394707,1.70462197394696,1.70462197394693,1.70462197394698,1.70462197394698,1.70462197394718,1.70462197394710,1.70462197394693,1.70462197394713,1.70462197394701,1.70462197394687,1.70462197394716,1.70462197394724,1.70462197394698,1.70462197394696,1.70462197394698,1.70462197394698,1.70462197394693,1.70462197394701,1.70462197394693,1.70462197394704,1.70462197394713,1.70462197394701,1.70462197394693,1.70462197394698,1.70462197394707];

figure(6);
plot(time,x11_2/100,time,x11_0/100,time,x11_pid/100,'LineWidth',1);
xlabel('time(s)','FontName','Times New Roman','FontSize',12);
ylabel('tracking error','FontName','Times New Roman','FontSize',12);
f22=legend('$SMPC$','$SMC$','$PID$');
set(f22,'Interpreter','latex','fontsize',10);